"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[573],{4573:(pt,N,l)=>{l.r(N),l.d(N,{InvoiceCreateEditModule:()=>lt});var h=l(6895),Z=l(8729),ne=l(7095),c=l(4006),F=l(8763),b=l(4794),A=l(4463),J=l(7379),oe=l(6254),L=l(9558),M=l(136),m=l(2134),O=l(5595),G=l(287),U=l(13),ie=l(1059),re=l(4850),I=l(7126),f=l(5412),B=l(6498),Q=l(591),D=l(537),e=l(4650),E=l(42),W=l(4286),y=l(6709),v=l(8490);const se=function(i){return{selected:i}};let ce=(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-work-order-selection-item"]],inputs:{dataModel:"dataModel"},features:[e._Bn([])],decls:31,vars:27,consts:[[1,"item-card",3,"ngClass"],[1,"container"],[1,"number"],[1,"date"],[1,"bold"],[1,"for-person"],[1,"value"],[1,"note"],[1,"description"],[1,"checkbox"],["name","Primary","color","primary",3,"checked"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span"),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"div",3)(7,"span",4),e._uU(8),e.ALo(9,"translate"),e.qZA(),e._uU(10),e.ALo(11,"date"),e.qZA(),e.TgZ(12,"div",5)(13,"div",6)(14,"span",4),e._uU(15),e.ALo(16,"translate"),e.qZA(),e._uU(17),e.qZA()(),e.TgZ(18,"div",7)(19,"div",6)(20,"span",4),e._uU(21),e.ALo(22,"translate"),e.qZA(),e._uU(23),e.qZA()(),e.TgZ(24,"div",8)(25,"span",4),e._uU(26),e.ALo(27,"translate"),e.qZA(),e._uU(28),e.qZA()(),e.TgZ(29,"div",9),e._UZ(30,"mat-checkbox",10),e.qZA()()),2&t&&(e.Q6J("ngClass",e.VKq(25,se,n.dataModel.selected)),e.xp6(4),e.AsE("",e.lcZ(5,12,"nr"),": ",n.dataModel.number,""),e.xp6(4),e.Oqu(e.lcZ(9,14,"date")),e.xp6(2),e.hij(": ",e.xi3(11,16,n.dataModel.date,"dd.MM.yyyy")," "),e.xp6(5),e.Oqu(e.lcZ(16,19,"forPerson")),e.xp6(2),e.hij(": ",n.dataModel.forPerson," "),e.xp6(4),e.Oqu(e.lcZ(22,21,"note")),e.xp6(2),e.hij(": ",n.dataModel.note," "),e.xp6(3),e.Oqu(e.lcZ(27,23,"description")),e.xp6(2),e.hij(": ",n.dataModel.description," "),e.xp6(2),e.Q6J("checked",n.dataModel.selected||!1))},dependencies:[h.mk,y.oG,h.uU,v.X$],styles:[".item-card[_ngcontent-%COMP%]{display:flex;cursor:pointer;transition:transform .5s ease;width:200px;height:200px;background-color:var(--color-white);position:relative;box-shadow:0 4px 4px #0000001a;border-radius:6px;border:1px solid var(--color-main-light, #bbbbbb);width:150px;height:150px;margin:10px}.item-card[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{position:absolute;width:100%;display:flex;flex-direction:column;margin-top:5px;width:150px;height:140px}.item-card[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-weight:600;margin:5px 0;text-align:center}.item-card[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{flex-grow:1;overflow:hidden;width:100%;height:100%}.item-card[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;position:absolute;z-index:1;margin-top:10px;margin-left:130px}.item-card.selected[_ngcontent-%COMP%]{opacity:.7}.item-card[_ngcontent-%COMP%]:hover{transform:scale(1.15)}.value[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.bold[_ngcontent-%COMP%]{font-weight:600}"]}),i})();var j=l(1572);function ae(i,a){1&i&&(e.TgZ(0,"div",7),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"noResults")," "))}function le(i,a){1&i&&(e.TgZ(0,"div",8),e._UZ(1,"mat-spinner"),e.qZA())}function ue(i,a){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-work-order-selection-item",9),e.NdJ("click",function(){const r=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.handleItemClick(r.item))}),e.qZA(),e.BQk()}if(2&i){const t=a.$implicit;e.xp6(1),e.Q6J("dataModel",t.item)}}function me(i,a){if(1&i&&(e.ynx(0),e.YNc(1,ae,3,3,"div",4),e.ALo(2,"async"),e.YNc(3,le,2,0,"div",5),e.ALo(4,"async"),e.YNc(5,ue,2,1,"ng-container",6),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",0===t.totalEntitiesLength&&!e.lcZ(2,3,t.isLoading)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,5,t.isLoading)),e.xp6(2),e.Q6J("ngForOf",t.items)}}function pe(i,a){1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"youDidntSelectAnyBuyer")))}let de=(()=>{class i{constructor(t,n,o,r,s){this.dialogRef=t,this.data=n,this.cdRef=o,this.webService=r,this.listEntities=s,this.subs=new A.L,this.buyerOID="",this.invoiceType="",this.excludedOids=[],this.isSingleSelection=!0,this.isLoading$=new Q.X(!1),this.isLoading=this.isLoading$.asObservable(),this.totalEntitiesLength=0,this.selection=[],this.items=[],this.buyerOID=n.buyerOID,this.excludedOids=n?.excludedOids||[],this.isSingleSelection=!1!==n.isSingleSelection}ngOnInit(){this.isLoading$.next(!0),this.subs.sink=this.webService.getAllUnsettledWorkOrderForBuyer(this.buyerOID).pipe((0,D.x)(()=>{this.isLoading$.next(!1)})).subscribe(t=>{this.items=t.map(n=>({item:{oid:n.oid,date:n.dateOfCreate,number:(0,m.Nw)(n),forPerson:n.forPerson,note:n.note,description:n.description},object:n})),this.totalEntitiesLength=this.items.length})}ngAfterViewInit(){this.cdRef.detectChanges()}handleItemClick(t){this.items=this.items.map(n=>this.isSingleSelection?{...n,item:{...n.item,selected:n.item.oid===t.oid}}:n.item.oid===t.oid?{...n,item:{...n.item,selected:!n.item.selected}}:{...n}),this.updateSelection()}updateSelection(){this.selection=[],this.items.forEach(t=>{t.item.selected&&this.selection.push(t.item.oid)})}saveSelection(){const t=[];this.items.forEach(n=>{n.item.selected&&t.push(n.object)}),this.dialogRef.close(t)}cancelSaveSelection(){this.dialogRef.close()}bottomReachedHandler(){this.listEntities.requestNextPage()}ngOnDestroy(){this.subs.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.so),e.Y36(f.WI),e.Y36(e.sBO),e.Y36(I.o),e.Y36(O.y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-work-order-selection-popup"]],features:[e._Bn([O.y,I.o])],decls:8,vars:9,consts:[["scrollToBottom","",3,"bottomReached"],[4,"ngIf"],["color","secondary",3,"text","clickEvent"],["color","primary",3,"text","disabled","clickEvent"],["class","no-results",4,"ngIf"],["class","spinner",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"no-results"],[1,"spinner"],[1,"item",3,"dataModel","click"]],template:function(t,n){1&t&&(e.TgZ(0,"mat-dialog-content",0),e.NdJ("bottomReached",function(){return n.bottomReachedHandler()}),e.YNc(1,me,6,7,"ng-container",1),e.YNc(2,pe,3,3,"ng-container",1),e.qZA(),e.TgZ(3,"mat-dialog-actions")(4,"app-button",2),e.NdJ("clickEvent",function(){return n.cancelSaveSelection()}),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"app-button",3),e.NdJ("clickEvent",function(){return n.saveSelection()}),e.ALo(7,"translate"),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.buyerOID),e.xp6(1),e.Q6J("ngIf",!n.buyerOID),e.xp6(2),e.Q6J("text",e.lcZ(5,5,"cancel")),e.xp6(2),e.Q6J("text",e.lcZ(7,7,"import"))("disabled",!n.selection.length))},dependencies:[h.sg,h.O5,f.xY,f.H8,E.r,W.C,ce,j.Ou,h.Ov,v.X$],styles:["mat-dialog-content[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid var(--attributes-border-color, #efeff3);display:flex;flex-wrap:wrap;height:calc(100% - 70px);max-height:100%}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.spacer[_ngcontent-%COMP%]{height:0;flex:1 1}"]}),i})(),H=(()=>{class i{constructor(t){this._matDialog=t,this.subs=new A.L}openDialog(t,n=[],o=!1){return new B.y(r=>{const s=new f.vA;s.width="80%",s.height="80%",s.data={buyerOID:t,excludedOids:n,isSingleSelection:o},this.subs.sink.$openSelectPopup=this._matDialog.open(de,s).afterClosed().subscribe(u=>{r.next(u),r.complete()},()=>r.error())})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(f.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var _e=l(6323);function he(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"i-feather",11),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.toggleExpandWorkOrder(o.object.oid))}),e.qZA()}2&i&&e.Q6J("name","plus")}function fe(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"i-feather",11),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.toggleExpandWorkOrder(o.object.oid))}),e.qZA()}2&i&&e.Q6J("name","minus")}function ve(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",16),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw(2).$implicit,s=e.oxw();return e.KtG(s.toggleSelectAll(o,r))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw(2).$implicit,n=e.oxw();e.Q6J("checked",n.isAllChecked(t)),e.xp6(1),e.Oqu(e.lcZ(2,2,"selectDeselectAll"))}}function ge(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",17),e.NdJ("ngModelChange",function(o){const s=e.CHM(t).$implicit;return e.KtG(s.selected=o)})("change",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.updateSelection())}),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()}if(2&i){const t=a.$implicit,n=e.oxw(3);e.Q6J("ngModel",t.selected),e.xp6(1),e.HOy(" ",t.object.description," ",e.lcZ(2,5,"pieces"),": ",t.object.sumQuantity," ",e.lcZ(3,7,n.getUOMDisplayValue(t.object.uom))," ")}}function Ce(i,a){if(1&i&&(e.TgZ(0,"div",12)(1,"div",13),e.YNc(2,ve,3,4,"mat-checkbox",14),e.YNc(3,ge,4,9,"mat-checkbox",15),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("ngIf",t.workOrderItems.length>1),e.xp6(1),e.Q6J("ngForOf",t.workOrderItems)}}function xe(i,a){if(1&i&&(e.TgZ(0,"div",5)(1,"div",6)(2,"div",7),e.YNc(3,he,1,1,"i-feather",8),e.YNc(4,fe,1,1,"i-feather",8),e.qZA(),e.TgZ(5,"div",9),e._uU(6),e.ALo(7,"translate"),e.ALo(8,"translate"),e.ALo(9,"translate"),e.ALo(10,"date"),e.qZA()(),e.YNc(11,Ce,4,2,"div",10),e.qZA()),2&i){const t=a.$implicit;e.xp6(3),e.Q6J("ngIf",!t.isExpanded),e.xp6(1),e.Q6J("ngIf",t.isExpanded),e.xp6(2),e.hij(" ",e.lcZ(7,4,"workOrder")+" "+e.lcZ(8,6,"nr")+" "+t.object.number+", "+e.lcZ(9,8,"date")+": "+e.xi3(10,10,t.object.dateOfCreate,"dd.MM.yyyy")," "),e.xp6(5),e.Q6J("ngIf",t.isExpanded)}}let Oe=(()=>{class i{constructor(t,n,o,r,s){this.dialogRef=t,this.data=n,this.cdRef=o,this.webService=r,this.listEntities=s,this.subs=new A.L,this.buyerOID="",this.invoiceType="",this.excludedOids=[],this.uomOptions=M.pM,this.getUOMDisplayValue=m.HL,this.isLoading$=new Q.X(!1),this.isLoading=this.isLoading$.asObservable(),this.selection=[],this.items=[],this.buyerOID=n.buyerOID,this.excludedOids=n?.excludedOids||[]}ngOnInit(){this.isLoading$.next(!0),this.subs.sink=this.webService.getAllUnsettledWorkOrderForBuyer(this.buyerOID).pipe((0,D.x)(()=>{this.isLoading$.next(!1)})).subscribe(t=>{this.items=t.map(n=>({oid:n.oid,isExpanded:!1,object:n,workOrderItems:n.workOrderItems.filter(o=>!this.excludedOids.includes(o.oid)).map(o=>({selected:!1,object:o}))}))})}ngAfterViewInit(){this.cdRef.detectChanges()}toggleExpandWorkOrder(t){const n=this.items.findIndex(o=>o.object.oid===t);this.items[n].isExpanded&&(this.items[n].workOrderItems=this.items[n].workOrderItems.map(o=>({...o,selected:!1}))),this.items[n].isExpanded=!this.items[n].isExpanded,this.updateSelection()}updateSelection(){this.selection=[],this.items.forEach(t=>{t.workOrderItems.forEach(n=>{n.selected&&this.selection.push(n.object.oid)})})}saveSelection(){const t=[];this.items.forEach(n=>{let o;n.workOrderItems.forEach(r=>{r.selected&&(o||(o={...n.object,workOrderItems:[]}),o.workOrderItems.push(r.object))}),o&&t.push(o)}),this.dialogRef.close(t)}cancelSaveSelection(){this.dialogRef.close()}bottomReachedHandler(){this.listEntities.requestNextPage()}toggleSelectAll(t,n){n.workOrderItems.forEach(t.checked?o=>o.selected=!0:o=>o.selected=!1),this.updateSelection()}isAllChecked(t){return t.workOrderItems.filter(n=>!0===n.selected).length===t.workOrderItems.length}ngOnDestroy(){this.subs.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.so),e.Y36(f.WI),e.Y36(e.sBO),e.Y36(I.o),e.Y36(O.y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-work-order-item-selection-popup"]],features:[e._Bn([O.y,I.o])],decls:8,vars:8,consts:[["scrollToBottom","",3,"bottomReached"],[1,"content"],["class","item",4,"ngFor","ngForOf"],["color","secondary",3,"text","clickEvent"],["color","primary",3,"text","disabled","clickEvent"],[1,"item"],[1,"title"],[1,"icon"],[3,"name","click",4,"ngIf"],[1,"description"],["class","childrens",4,"ngIf"],[3,"name","click"],[1,"childrens"],[1,"child"],["color","primary",3,"checked","change",4,"ngIf"],["color","primary",3,"ngModel","ngModelChange","change",4,"ngFor","ngForOf"],["color","primary",3,"checked","change"],["color","primary",3,"ngModel","ngModelChange","change"]],template:function(t,n){1&t&&(e.TgZ(0,"mat-dialog-content",0),e.NdJ("bottomReached",function(){return n.bottomReachedHandler()}),e.TgZ(1,"div",1),e.YNc(2,xe,12,13,"div",2),e.qZA()(),e.TgZ(3,"mat-dialog-actions")(4,"app-button",3),e.NdJ("clickEvent",function(){return n.cancelSaveSelection()}),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"app-button",4),e.NdJ("clickEvent",function(){return n.saveSelection()}),e.ALo(7,"translate"),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngForOf",n.items),e.xp6(2),e.Q6J("text",e.lcZ(5,4,"cancel")),e.xp6(2),e.Q6J("text",e.lcZ(7,6,"import"))("disabled",!n.selection.length))},dependencies:[h.sg,h.O5,f.xY,f.H8,E.r,W.C,_e.u,y.oG,c.JJ,c.On,h.uU,v.X$],styles:["mat-dialog-content[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid var(--attributes-border-color, #efeff3);display:flex;flex-wrap:wrap;height:calc(100% - 70px);max-height:100%}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow-y:auto;flex-grow:1}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-bottom:1px dotted var(--color-main)}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;color:var(--color-info)}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{display:flex}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .childrens[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-left:40px}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .childrens[_ngcontent-%COMP%]   .child[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.spacer[_ngcontent-%COMP%]{height:0;flex:1 1}"]}),i})(),K=(()=>{class i{constructor(t){this._matDialog=t,this.subs=new A.L}openDialog(t,n=[]){return new B.y(o=>{const r=new f.vA;r.width="80%",r.height="80%",r.data={buyerOID:t,excludedOids:n},this.subs.sink.$openSelectPopup=this._matDialog.open(Oe,r).afterClosed().subscribe(s=>{o.next(s),o.complete()},()=>o.error())})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(f.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var Ie=l(3851),ye=l(8794),be=l(7347),Ae=l(8879),ke=l(8933),k=l(9549),R=l(4144),w=l(4385),Ze=l(3238),Y=l(3231),V=l(266),z=l(4603),we=l(3336),P=l(7957);function Te(i,a){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.AsE(" - ",e.lcZ(2,2,"madeFromPreinvoiceNr"),": ",t.preInvoice.number,"")}}function Me(i,a){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.AsE(" - ",e.lcZ(2,2,"madeFromAdvanceinvoiceNr"),": ",t.advanceInvoice.number,"")}}function Ee(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.displayName)," ")}}function Pe(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"input",37),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onKeypress(o,"numberOfCashBill"))}),e.qZA()()}2&i&&(e.xp6(1),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(3,5,"numberOfCashBill")," "))}function Se(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.Q6J("value",t.selectedBuyer),e.xp6(1),e.Oqu(t.selectedBuyer.name)}}function qe(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Ne(i,a){if(1&i&&(e.ynx(0),e.YNc(1,qe,2,2,"mat-option",15),e.BQk()),2&i){const t=a.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",(null==n.selectedBuyer?null:n.selectedBuyer.oid)!==t.oid)}}function Fe(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-button",38),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.createBuyer())}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("iconName","plus")("disabled",!t.hasPrivilege("BUYER_CREATE"))}}const $=function(){return{standalone:!0}};function Je(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",39),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.allowChangeBuyer=o)}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("color","primary")("ngModel",t.allowChangeBuyer)("ngModelOptions",e.DdM(6,$)),e.xp6(1),e.Oqu(e.lcZ(2,4,"changeBuyer"))}}function Le(i,a){if(1&i&&(e.TgZ(0,"mat-option"),e._UZ(1,"ngx-mat-select-search",14),e.ALo(2,"translate"),e.ALo(3,"translate"),e.ALo(4,"async"),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.s9C("placeholderLabel",e.lcZ(2,7,"searchFor")),e.s9C("noEntriesFoundLabel",e.lcZ(3,9,"noResults")),e.Q6J("formControl",t.searchControlOnChange)("hideClearSearchButton",!0)("clearSearchInput",!0)("searching",e.lcZ(4,11,t.isLoadingOnChange)||!1)("disableScrollToActiveOnOptionsChanged",!0)}}function Ge(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.Q6J("value",t.selectedBuyerOnChange),e.xp6(1),e.Oqu(t.selectedBuyerOnChange.name)}}function Ue(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Be(i,a){if(1&i&&(e.ynx(0),e.YNc(1,Ue,2,2,"mat-option",15),e.BQk()),2&i){const t=a.$implicit,n=e.oxw(3);e.xp6(1),e.Q6J("ngIf",(null==n.selectedBuyerOnChange?null:n.selectedBuyerOnChange.oid)!==t.oid)}}function Qe(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",40),e.NdJ("infiniteScroll",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.bottomReachedHandlerBuyersOnChange())})("selectionChange",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.selectBuyerOnChange(o))}),e.YNc(5,Le,5,13,"mat-option",3),e.YNc(6,Ge,2,2,"mat-option",15),e.YNc(7,Be,2,1,"ng-container",16),e.ALo(8,"async"),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(3,9,"buyer")," "),e.xp6(2),e.Q6J("compareWith",t.compareFn),e.xp6(1),e.Q6J("ngIf",t.isEdit),e.xp6(1),e.Q6J("ngIf",t.selectedBuyerOnChange),e.xp6(1),e.Q6J("ngForOf",e.lcZ(8,11,t.buyersEntitiesOnChange))}}function De(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function We(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.displayName)," ")}}function je(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",61),e.NdJ("click",function(){const r=e.CHM(t).index,s=e.oxw(2).index,u=e.oxw(3);return e.KtG(u.removeWorkOrderItemFromInvoiceItem(s,r))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=a.$implicit,n=e.oxw(5);e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.value.description+", "+t.value.sumQuantity+" "+e.lcZ(2,2,n.getUOMDisplayValue(t.value.uom)))}}function He(i,a){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",59),e.YNc(5,je,3,4,"mat-option",60),e.qZA()()),2&i){const t=e.oxw(),n=t.$implicit,o=t.index,r=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,3,"workOrder")),e.xp6(2),e.Q6J("value",n.value.workOrderItems),e.xp6(1),e.Q6J("ngForOf",r.getWorkOrderItemsFormArr(o).controls)}}function Ke(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",43)(1,"div",44)(2,"mat-form-field",45)(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"input",46,47),e.NdJ("keydown.enter",function(){e.CHM(t);const o=e.MAs(7);return e.KtG(o.closePanel())})("keypress",function(o){const s=e.CHM(t).index,u=e.oxw(3);return e.KtG(u.onKeypress(o,"description",s))}),e.qZA(),e.TgZ(8,"mat-autocomplete",null,48),e.YNc(10,De,2,2,"mat-option",9),e.ALo(11,"async"),e.qZA()(),e.TgZ(12,"mat-form-field",49)(13,"mat-label"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"mat-select",50),e.NdJ("openedChange",function(o){const s=e.CHM(t).index,u=e.oxw(3);return e.KtG(u.openedToggleOnUomSelect(o,s))}),e.YNc(17,We,3,4,"mat-option",9),e.qZA()(),e.TgZ(18,"mat-form-field",49)(19,"mat-label"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"input",51),e.NdJ("keypress",function(o){const s=e.CHM(t).index,u=e.oxw(3);return e.KtG(u.onKeypress(o,"quantity",s))})("change",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.calculateInvoiceItemAmount(r,"quantity"))})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),e.KtG(o.setAllInvoiceAmounts())}),e.qZA()(),e.TgZ(23,"mat-form-field",49)(24,"mat-label"),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.TgZ(27,"input",52),e.NdJ("keypress",function(o){const s=e.CHM(t).index,u=e.oxw(3);return e.KtG(u.onKeypress(o,"pricePerUnit",s))})("change",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.calculateInvoiceItemAmount(r,"pricePerUnit"))})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),e.KtG(o.setAllInvoiceAmounts())}),e.qZA()(),e.TgZ(28,"mat-form-field",49)(29,"mat-label"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"input",53),e.NdJ("keypress",function(o){const s=e.CHM(t).index,u=e.oxw(3);return e.KtG(u.onKeypress(o,"netPrice",s))})("change",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.calculateInvoiceItemAmount(r,"netPrice"))})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),e.KtG(o.setAllInvoiceAmounts())}),e.qZA()(),e.TgZ(33,"mat-form-field",49)(34,"mat-label"),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"input",54),e.NdJ("keypress",function(o){const s=e.CHM(t).index,u=e.oxw(3);return e.KtG(u.onKeypress(o,"vatRate",s))})("change",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.calculateInvoiceItemAmount(r,"vatRate"))})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),e.KtG(o.setAllInvoiceAmounts())}),e.qZA()(),e.TgZ(38,"mat-form-field",49)(39,"mat-label"),e._uU(40),e.ALo(41,"translate"),e.qZA(),e.TgZ(42,"input",55),e.NdJ("keypress",function(o){const s=e.CHM(t).index,u=e.oxw(3);return e.KtG(u.onKeypress(o,"vatAmount",s))})("change",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.calculateInvoiceItemAmount(r,"vatAmount"))})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),e.KtG(o.setAllInvoiceAmounts())}),e.qZA()(),e.TgZ(43,"mat-form-field",49)(44,"mat-label"),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.TgZ(47,"input",56),e.NdJ("keypress",function(o){const s=e.CHM(t).index,u=e.oxw(3);return e.KtG(u.onKeypress(o,"grossPrice",s))})("change",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.calculateInvoiceItemAmount(r,"grossPrice"))})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),e.KtG(o.setAllInvoiceAmounts())}),e.qZA()(),e.YNc(48,He,6,5,"mat-form-field",3),e.TgZ(49,"app-button",57),e.NdJ("clickEvent",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.importWorkOrderItems(r))}),e.ALo(50,"translate"),e.qZA(),e.TgZ(51,"app-button",58),e.NdJ("clickEvent",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.removeItem(r))}),e.qZA()()()}if(2&i){const t=a.$implicit,n=a.index,o=e.MAs(9),r=e.oxw(3);let s;e.xp6(1),e.Q6J("formGroupName",n),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(5,49,"description")," "),e.xp6(2),e.Q6J("matAutocomplete",o)("matTooltip",null==(s=r.getDescription(n))?null:s.value),e.xp6(4),e.Q6J("ngForOf",e.lcZ(11,51,r.getFilteredOptions(n))),e.xp6(3),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(15,53,"uom")," "),e.xp6(3),e.Q6J("ngForOf",r.uomOptions),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(21,55,"quantity")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(26,57,"pricePerUnit")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(31,59,"netPrice")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(36,61,"vatRate")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(41,63,"vatAmount")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(46,65,"grossPrice")," "),e.xp6(3),e.Q6J("ngIf",t.value.workOrderItems.length>0),e.xp6(1),e.Q6J("text",e.lcZ(50,67,"import")),e.xp6(2),e.Q6J("iconName","minus")("isTransparentMode",!0)}}function Re(i,a){if(1&i&&(e.TgZ(0,"div",41),e.YNc(1,Ke,52,69,"div",42),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.invoiceItemsFormArr.controls)}}function Ye(i,a){1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"input",62),e.qZA()),2&i&&(e.xp6(1),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(3,5,"advancePayAmount")," "))}function Ve(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",7)(1,"div",44)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"input",66),e.qZA(),e.TgZ(7,"mat-form-field")(8,"mat-label"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e._UZ(11,"input",67),e.qZA()(),e.TgZ(12,"app-button",58),e.NdJ("clickEvent",function(){const r=e.CHM(t).index,s=e.oxw(3);return e.KtG(s.removeNote(r))}),e.qZA()()}if(2&i){const t=a.index;e.xp6(1),e.Q6J("formGroupName",t),e.xp6(3),e.Oqu(e.lcZ(5,5,"field")),e.xp6(5),e.Oqu(e.lcZ(10,7,"value")),e.xp6(3),e.Q6J("iconName","minus")("isTransparentMode",!0)}}function ze(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",63),e.YNc(1,Ve,13,9,"div",64),e.TgZ(2,"app-button",65),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.addNote())}),e.ALo(3,"translate"),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.notesFormArr.controls),e.xp6(1),e.Q6J("text",e.lcZ(3,2,"addNote"))}}function $e(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"form",6)(1,"div",7)(2,"mat-form-field")(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",8),e.NdJ("valueChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.invoiceTypeChanged(o))}),e.YNc(7,Ee,3,4,"mat-option",9),e.qZA()(),e.YNc(8,Pe,5,7,"mat-form-field",3),e.TgZ(9,"mat-form-field")(10,"mat-label"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"input",10),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"currency"))}),e.qZA()(),e.TgZ(14,"mat-form-field")(15,"mat-label"),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"input",11),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"number"))}),e.qZA()(),e.TgZ(19,"app-button",12),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.setInvoiceNumber())}),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"div",7)(22,"mat-form-field")(23,"mat-label"),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"mat-select",13),e.NdJ("valueChange",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.buyerChanged())})("infiniteScroll",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.bottomReachedHandlerBuyers())})("selectionChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectBuyer(o))}),e.TgZ(27,"mat-option"),e._UZ(28,"ngx-mat-select-search",14),e.ALo(29,"translate"),e.ALo(30,"translate"),e.ALo(31,"async"),e.qZA(),e.YNc(32,Se,2,2,"mat-option",15),e.YNc(33,Ne,2,1,"ng-container",16),e.ALo(34,"async"),e.qZA()(),e.YNc(35,Fe,1,2,"app-button",17),e.YNc(36,Je,3,7,"mat-checkbox",18),e.YNc(37,Qe,9,13,"mat-form-field",3),e.TgZ(38,"mat-checkbox",19),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.isInvoiceTaxFree=o)})("change",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.changeIsInvoiceTaxFree())}),e._uU(39),e.ALo(40,"translate"),e.qZA()(),e.TgZ(41,"div",7)(42,"mat-form-field")(43,"mat-label"),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"input",20),e.NdJ("change",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.consolidateAllDates())})("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"dateOfCreate"))}),e.qZA()(),e.TgZ(47,"mat-form-field")(48,"mat-label"),e._uU(49),e.ALo(50,"translate"),e.qZA(),e.TgZ(51,"input",21),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"dateOfTurnover"))}),e.qZA()(),e.TgZ(52,"mat-form-field")(53,"mat-label"),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.TgZ(56,"input",22),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"dateOfMaturity"))}),e.qZA()()(),e.TgZ(57,"div",7)(58,"mat-form-field")(59,"mat-label"),e._uU(60),e.ALo(61,"translate"),e.qZA(),e.TgZ(62,"input",23),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"country"))}),e.qZA()(),e.TgZ(63,"mat-form-field")(64,"mat-label"),e._uU(65),e.ALo(66,"translate"),e.qZA(),e.TgZ(67,"input",24),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"placeOfIssue"))}),e.qZA()(),e.TgZ(68,"mat-form-field")(69,"mat-label"),e._uU(70),e.ALo(71,"translate"),e.qZA(),e.TgZ(72,"input",25),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"methodOfPayment"))}),e.qZA()()(),e.YNc(73,Re,2,1,"div",26),e.TgZ(74,"div",27)(75,"app-button",28),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.addNewItem())}),e.ALo(76,"translate"),e.qZA(),e.TgZ(77,"app-button",29),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.autoImport())}),e.ALo(78,"translate"),e.qZA()(),e.TgZ(79,"mat-form-field")(80,"mat-label"),e._uU(81),e.ALo(82,"translate"),e.qZA(),e.TgZ(83,"textarea",30),e.NdJ("keypress",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onKeypress(o,"comment"))}),e.qZA()(),e.TgZ(84,"div",7)(85,"mat-form-field")(86,"mat-label"),e._uU(87),e.ALo(88,"translate"),e.qZA(),e._UZ(89,"input",31),e.qZA(),e.TgZ(90,"mat-form-field")(91,"mat-label"),e._uU(92),e.ALo(93,"translate"),e.qZA(),e._UZ(94,"input",32),e.qZA(),e.TgZ(95,"mat-form-field")(96,"mat-label"),e._uU(97),e.ALo(98,"translate"),e.qZA(),e._UZ(99,"input",33),e.qZA(),e.TgZ(100,"mat-form-field")(101,"mat-label"),e._uU(102),e.ALo(103,"translate"),e.qZA(),e._UZ(104,"input",34),e.qZA(),e.YNc(105,Ye,5,7,"mat-form-field",3),e.qZA(),e.YNc(106,ze,4,4,"div",35),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("formGroup",t.formGroup),e.xp6(3),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(5,114,"type")," "),e.xp6(2),e.Q6J("disabled",t.isEdit),e.xp6(1),e.Q6J("ngForOf",t.typesOptions),e.xp6(1),e.Q6J("ngIf",t.numberOfCashBillControl),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(12,116,"currency")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(17,118,"number")," "),e.xp6(3),e.Q6J("isTransparentMode",!0)("text",e.lcZ(20,120,"createNumber")),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(25,122,"buyer")," "),e.xp6(2),e.Q6J("disabled",t.isEdit)("compareWith",t.compareFn)("matTooltip",(null==t.selectedBuyer?null:t.selectedBuyer.name)||""),e.xp6(2),e.s9C("placeholderLabel",e.lcZ(29,124,"searchFor")),e.s9C("noEntriesFoundLabel",e.lcZ(30,126,"noResults")),e.Q6J("formControl",t.searchControl)("hideClearSearchButton",!0)("clearSearchInput",!0)("searching",e.lcZ(31,128,t.isLoading)||!1)("disableScrollToActiveOnOptionsChanged",!0),e.xp6(4),e.Q6J("ngIf",t.selectedBuyer),e.xp6(1),e.Q6J("ngForOf",e.lcZ(34,130,t.buyersEntities)),e.xp6(2),e.Q6J("ngIf",!t.isEdit),e.xp6(1),e.Q6J("ngIf",t.isEdit),e.xp6(1),e.Q6J("ngIf",t.isEdit&&t.allowChangeBuyer),e.xp6(1),e.Q6J("color","primary")("ngModel",t.isInvoiceTaxFree)("ngModelOptions",e.DdM(160,$)),e.xp6(1),e.Oqu(e.lcZ(40,132,"invoiceTaxFree")),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(45,134,"dateOfCreate")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(50,136,"dateOfTurnover")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(55,138,"dateOfMaturity")," "),e.xp6(5),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(61,140,"country")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(66,142,"placeOfIssue")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(71,144,"methodOfPayment")," "),e.xp6(3),e.Q6J("ngIf",t.isBuyerSelected),e.xp6(2),e.Q6J("iconName","plus")("text",e.lcZ(76,146,"addNewItem"))("disabled",!t.isBuyerSelected),e.xp6(2),e.Q6J("iconName","plus")("text",e.lcZ(78,148,"autoImport"))("isTransparentMode",!0)("disabled",!t.isBuyerSelected),e.xp6(3),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(82,150,"comment")," "),e.xp6(5),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(88,152,"netAmount")," "),e.xp6(2),e.Q6J("readonly",!0),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(93,154,"vatRate")," "),e.xp6(2),e.Q6J("readonly",!0),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(98,156,"vatAmount")," "),e.xp6(2),e.Q6J("readonly",!0),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(103,158,"grossAmount")," "),e.xp6(2),e.Q6J("readonly",!0),e.xp6(1),e.Q6J("ngIf",t.advanceInvoice||t.invoice&&t.invoice.advancePayAmount>0),e.xp6(1),e.Q6J("ngIf",t.notesFormArr.controls)}}function Xe(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",68)(1,"app-button",69),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.cancel())}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"app-button",70),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.generateXMLFile())}),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"app-button",70),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.registrate())}),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"app-button",70),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.getInvoiceFromSEF())}),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"app-button",70),e.NdJ("clickEvent",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.handleSubmitButton())}),e.ALo(10,"translate"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("text",e.lcZ(2,9,"cancel")),e.xp6(2),e.Q6J("text",e.lcZ(4,11,"generateXMLFile"))("disabled",t.formGroup.invalid||!t.isEdit),e.xp6(2),e.Q6J("text",e.lcZ(6,13,"registrateInvoice"))("disabled",t.formGroup.invalid||!t.isEdit),e.xp6(2),e.Q6J("text",e.lcZ(8,15,"getInvoiceFromSEF"))("disabled",t.formGroup.invalid||!t.isEdit),e.xp6(2),e.Q6J("text",e.lcZ(10,17,"save"))("disabled",!t.formGroup.dirty||t.formGroup.invalid)}}const et=[{path:"",component:(()=>{class i{constructor(t,n,o,r,s,u,d,p,te,g,C,_,x,T,ut,mt){this.router=t,this.route=n,this.globalService=o,this.webService=r,this.workOrderWebService=s,this.buyerWebService=u,this.buyerCreateEditPopupService=d,this.settingsStoreService=p,this.translateService=te,this.listEntities=g,this.listEntitiesOnChange=C,this.el=_,this.workOrderSelectionComponentService=x,this.workOrderItemSelectionComponentService=T,this.sweetAlertService=ut,this.authStoreService=mt,this.subs=new A.L,this.invoiceOID=null,this.isEdit=!1,this.typesOptions=M.TY,this.uomOptions=M.pM,this.invoiceItemsOptions=[],this.filteredOptions=[],this.buyersEntities=this.listEntities.entities,this.isLoading=this.listEntities.isLoading,this.searchControl=new c.p4,this.compareFn=m.nt,this.isInvoiceTaxFree=!1,this.allowChangeBuyer=!1,this.buyersEntitiesOnChange=this.listEntities.entities,this.isLoadingOnChange=this.listEntities.isLoading,this.searchControlOnChange=new c.p4,this.debounceTime=500,this.getUOMDisplayValue=m.HL}get numberOfCashBillControl(){return this.formGroup.get("numberOfCashBill")}getDescription(t){return this.invoiceItemsFormArr.controls[t].get("description")}getUOM(t){return this.invoiceItemsFormArr.controls[t].get("uom")}getQuantity(t){return this.invoiceItemsFormArr.controls[t].get("quantity")}getPricePerUnit(t){return this.invoiceItemsFormArr.controls[t].get("pricePerUnit")}getNetPrice(t){return this.invoiceItemsFormArr.controls[t].get("netPrice")}getVatRate(t){return this.invoiceItemsFormArr.controls[t].get("vatRate")}getVatAmount(t){return this.invoiceItemsFormArr.controls[t].get("vatAmount")}getGrossPrice(t){return this.invoiceItemsFormArr.controls[t].get("grossPrice")}getWorkOrderItemsFormArr(t){return this.invoiceItemsFormArr.controls[t].get("workOrderItems")}get invoiceItemsFormArr(){return this.formGroup.get("invoiceItems")}get notesFormArr(){return this.formGroup.get("notes")}ngOnInit(){this.invoiceOID=this.route.snapshot.paramMap.get("invoiceOID");const t=this.route.snapshot.queryParamMap.get("workOrderOID"),n=this.route.snapshot.queryParamMap.get("preInvoiceOID"),o=this.route.snapshot.queryParamMap.get("advanceInvoiceOID");this.subs.sink=this.webService.getAllInvoiceItemDescriptions().subscribe(r=>{this.invoiceItemsOptions=r}),this.subs.sink=this.listEntities.setWebService(this.buyerWebService).requestFirstPage(),this.isEdit&&(this.subs.sink=this.listEntitiesOnChange.setWebService(this.buyerWebService).requestFirstPage()),this.subs.sink=this.settingsStoreService.dataLoaded$.subscribe(r=>{r&&(this.settings=this.settingsStoreService.getSettings(),this.isEdit=!!this.invoiceOID,this.isEdit&&this.invoiceOID?this.subs.sink=this.webService.getEntityByOid(this.invoiceOID).subscribe(s=>{this.invoice=s,this.invoice.preInvoiceOid&&(this.subs.sink=this.webService.getEntityByOid(this.invoice.preInvoiceOid).subscribe(u=>{this.preInvoice=u})),this.invoice.advanceInvoiceOid&&(this.subs.sink=this.webService.getEntityByOid(this.invoice.advanceInvoiceOid).subscribe(u=>{this.preInvoice=u})),this.initializeCreate()}):(this.initializeCreate(),t?this.workOrderWebService.getEntityByOid(t).subscribe(s=>{this.formGroup.get("buyer")?.setValue(s.buyer),this.selectedBuyer=s.buyer,this.addWorkOrderToNewInvoiceItem([s])}):n?this.importInvoiceFrom("preInvoice",n):o&&this.importInvoiceFrom("advanceInvoice",o)))}),this.inputSearchControlSubscription=this.searchControl.valueChanges.pipe((0,U.b)(this.debounceTime)).subscribe(()=>{this.searchHandler(this.searchControl.value)}),this.inputSearchControlOnChangeSubscription=this.searchControlOnChange.valueChanges.pipe((0,U.b)(this.debounceTime)).subscribe(()=>{this.searchHandlerOnChange(this.searchControlOnChange.value)})}hasPrivilege(t){return this.authStoreService.isAllowed(t)}initializeCreate(t=!1){this.isEdit&&(this.selectedBuyer=this.invoice.buyer),this.formGroup=new c.nJ({type:new c.p4(t?this.typesOptions[5].value:this.invoice?.type||this.typesOptions[0].value,[c.kI.required]),number:new c.p4(this.invoice?.number||0,[c.kI.required]),dateOfCreate:new c.p4(this.invoice?.dateOfCreate||(new Date).toISOString().substring(0,10),[c.kI.required]),dateOfTurnover:new c.p4(this.invoice?.dateOfTurnover||(new Date).toISOString().substring(0,10),[c.kI.required]),dateOfMaturity:new c.p4(this.invoice?.dateOfMaturity||(new Date).toISOString().substring(0,10),[c.kI.required]),placeOfIssue:new c.p4(this.invoice?.placeOfIssue||this.settings?.invoicePlaceOfIssue||"",[c.kI.required]),methodOfPayment:new c.p4(this.invoice?.methodOfPayment||this.settings?.invoiceMethodOfPayment,[c.kI.required]),comment:new c.p4(this.invoice?.comment||"",[]),netAmount:new c.p4(this.invoice?.netAmount||0,[c.kI.required,c.kI.min(.01)]),vatRate:new c.p4(this.invoice?.vatRate||0,[c.kI.required]),vatAmount:new c.p4(this.invoice?.vatAmount||0,[c.kI.required]),grossAmount:new c.p4(this.invoice?.grossAmount||0,[c.kI.required,c.kI.min(.01)]),currency:new c.p4(this.invoice?.currency||this.settings?.invoiceCurrency||"",[c.kI.required]),country:new c.p4(this.invoice?.country||this.settings?.invoiceCountry||"",[c.kI.required]),buyer:new c.p4(this.selectedBuyer||"",[c.kI.required]),invoiceItems:new c.vC([]),notes:new c.vC([]),preInvoiceOid:new c.p4(this.preInvoice?.oid),advanceInvoiceOid:new c.p4(this.advanceInvoice?.oid),advancePayAmount:new c.p4(this.invoice?.advancePayAmount||this.advanceInvoice?.grossAmount||0)}),"CASH"===this.formGroup.get("type")?.value&&this.formGroup.addControl("numberOfCashBill",new c.p4(this.invoice.numberOfCashBill||"",[c.kI.required])),this.isEdit?(this.invoice.invoiceItems.forEach(n=>this.addNewItem(n)),this.invoice.notes.forEach(n=>this.addNote(n))):this.setInvoiceNumber()}selectBuyer(t){t&&t.value&&(this.selectedBuyer=t.value)}selectBuyerOnChange(t){if(t&&t.value){this.selectedBuyerOnChange=t.value,this.subs.sink.$markWorkOrder=this.sweetAlertService.getDataBackFromSweetAlert().subscribe(o=>{o&&o.confirmed&&this.invoiceOID&&this.selectedBuyerOnChange?.oid&&(this.subs.sink=this.webService.changeBuyer(this.invoiceOID,this.selectedBuyerOnChange?.oid).subscribe(r=>{r&&(this.globalService.showBasicAlert(b.I.success,this.translateService.instant("successfully"),this.translateService.instant("invoiceIsSuccessfullyUpdated")),window.location.reload())}))});const n={mode:"warning",icon:"alert-triangle",type:{name:Ie.N.submit,buttons:{submit:this.translateService.instant("change"),cancel:this.translateService.instant("cancel")}},title:this.translateService.instant("changeBuyer"),message:this.translateService.instant("areYouSureYouWantToAllowChangeOfBuyerWithAllConsequences")};this.sweetAlertService.openMeSweetAlert(n)}}isBuyerSelected(){return!!this.formGroup.get("buyer")?.value}addNewItem(t){this.invoiceItemsFormArr.push(new c.nJ({oid:new c.p4(t?.oid||""),description:new c.p4(t?.description||"",[c.kI.required]),uom:new c.p4(t?.uom||this.uomOptions[0].value,[c.kI.required]),quantity:new c.p4(t?.quantity||0,[c.kI.required,c.kI.min(0)]),pricePerUnit:new c.p4(t?.pricePerUnit||0,[c.kI.required,c.kI.min(0)]),netPrice:new c.p4(t?.netPrice||0,[c.kI.required,c.kI.min(0)]),vatRate:new c.p4(t?t.vatRate:(this.isInvoiceTaxFree?0:this.settings?.invoiceVatRate)||0,[c.kI.required,c.kI.min(0)]),vatAmount:new c.p4(t?.vatAmount||0,[c.kI.required,c.kI.min(0)]),grossPrice:new c.p4(t?.grossPrice||0,[c.kI.required,c.kI.min(0)]),workOrderItems:new c.vC([])})),setTimeout(()=>{const n=this.getDescription(this.invoiceItemsFormArr.length-1)?.valueChanges.pipe((0,ie.O)(""),(0,re.U)(o=>this._filter(o||"")));this.filteredOptions.push(n)}),t?.workOrderItems.forEach(n=>{this.addNewWorkOrderItemToInvoiceItem(this.invoiceItemsFormArr.length-1,[n])}),this.calculateInvoiceAmount()}_filter(t){const n=t.toLowerCase();return this.invoiceItemsOptions.filter(o=>o.toLowerCase().includes(n))}addWorkOrderToNewInvoiceItem(t){const n=[],o=this.getAllImportedWorkOrderItemOIDS();t.forEach(r=>{r.workOrderItems.forEach(s=>{if(!o.includes(s.oid)){let u={oid:"",description:s.description,uom:s.uom,quantity:s.sumQuantity,pricePerUnit:0,netPrice:0,vatRate:this.settings?.invoiceVatRate||20,vatAmount:0,grossPrice:0,workOrderItems:[s]};const d=n.filter(p=>p.description===u.description&&p.uom===u.uom)[0];d?(d.quantity=d.quantity+u.quantity,d.workOrderItems.push(s)):n.push(u)}}),this.addWorkOrderToComment(r)}),n.forEach(r=>{this.addNewItem(r)})}addWorkOrderToComment(t){const n=this.formGroup.get("comment");n?.value.length&&!n?.value.includes((0,m.Nw)(t))?n.setValue(n.value+", "+(0,m.Nw)(t)):n?.setValue(this.translateService.instant("attachmentWorkOrderNumber")+" "+(0,m.Nw)(t))}addNewWorkOrderItemToInvoiceItem(t,n){n.forEach(o=>{this.getWorkOrderItemsFormArr(t).push(new c.nJ({oid:new c.p4(o.oid),description:new c.p4(o.description),uom:new c.p4(o.uom),dimension1:new c.p4(o.dimension1),dimension2:new c.p4(o.dimension2),dimension3:new c.p4(o.dimension3),quantity:new c.p4(o.quantity),sumQuantity:new c.p4(o.sumQuantity),note:new c.p4(o.note)}))})}importWorkOrderItems(t){this.workOrderItemSelectionComponentService.openDialog(this.selectedBuyer?.oid||"",this.getAllImportedWorkOrderItemOIDS()).subscribe(n=>{if(n){const o=[];n.forEach(r=>{r.workOrderItems.forEach(s=>{let u={oid:"",description:s.description,uom:s.uom,quantity:s.sumQuantity,pricePerUnit:0,netPrice:0,vatRate:this.settings?.invoiceVatRate||20,vatAmount:0,grossPrice:0,workOrderItems:[s]};const d=o.filter(p=>p.uom===u.uom)[0];d?(d.description=d.description.includes(s.description)?s.description:d.description+", "+s.description,d.quantity=d.quantity+u.quantity,d.workOrderItems.push(s)):o.push(u)})}),o.forEach((r,s)=>{const u=this.getDescription(t)?.value;!u&&0===this.getQuantity(t)?.value||this.getDescription(t)?.value.includes(r.description)&&this.getUOM(t)?.value===r.uom?(u.includes(r.description)||this.getDescription(t)?.setValue(u.length?", "+r.description:r.description),this.getUOM(t)?.setValue(r.uom),this.getQuantity(t)?.setValue(this.getQuantity(t)?.value+r.quantity),this.addNewWorkOrderItemToInvoiceItem(t,r.workOrderItems)):this.addNewItem(r)}),n.forEach(r=>{this.addWorkOrderToComment(r)})}})}removeWorkOrderItemFromInvoiceItem(t,n){this.getWorkOrderItemsFormArr(t).removeAt(n),this.formGroup.markAsDirty()}buyerChanged(){setTimeout(()=>{this.isBuyerSelected=this.formGroup.get("buyer")?.value;for(let t=this.invoiceItemsFormArr.controls.length-1;t>=0;t--)this.invoiceItemsFormArr.controls[t].value.workOrderItems&&this.invoiceItemsFormArr.controls[t].value.workOrderItems.length&&this.invoiceItemsFormArr.removeAt(t);this.setFocusOn("dateOfCreate")})}removeItem(t){this.invoiceItemsFormArr.removeAt(t),this.calculateInvoiceAmount(),this.formGroup.markAsDirty()}cancel(){this.router.navigate(["/"])}handleSubmitButton(){this.setAllInvoiceAmounts(),this.isEdit&&this.invoiceOID?this.webService.updateEntity(this.invoiceOID,this.formGroup.value).subscribe(t=>{t&&this.globalService.showBasicAlert(b.I.success,this.translateService.instant("successfully"),this.translateService.instant("invoiceIsSuccessfullyUpdated"))}):this.webService.createEntity(this.formGroup.value).subscribe(t=>{t&&(this.globalService.showBasicAlert(b.I.success,this.translateService.instant("successfully"),this.translateService.instant("newInvoiceIsSuccessfullyCreated")),window.open("#/print/invoice-view/"+t.oid),this.router.navigate(["invoices","edit",t.oid]))})}invoiceTypeChanged(t){setTimeout(()=>{if(this.formGroup.get("comment")?.setValue(""),"FOREIGN"!==t&&this.notesFormArr.controls.length)for(let n=this.notesFormArr.controls.length-1;n>=0;n--)this.removeNote(n);switch(t){case"CASH":this.formGroup.addControl("numberOfCashBill",new c.p4("",[c.kI.required])),this.formGroup.get("currency")?.setValue(this.settings?.invoiceCurrency),setTimeout(()=>{this.setFocusOn("numberOfCashBill")}),this.formGroup.get("methodOfPayment")?.setValue(this.settings?.invoiceMethodOfPaymentForCashBill);break;case"FOREIGN":this.formGroup.get("currency")?.setValue("EUR"),this.formGroup.get("comment")?.setValue(this.settings?.invoiceForeignNote),this.settings?.invoiceForeignNotes?.forEach(n=>{this.addNote({oid:"",name:n.key,description:n.value})}),this.formGroup.get("methodOfPayment")?.setValue(this.settings?.invoiceMethodOfPayment);break;case"FINAL":this.globalService.showBasicAlert(b.I.error,this.translateService.instant("invoiceTypeError"),this.translateService.instant("finalInvoiceCanBeSelectedOnlyFromAdvanceInvoice")),this.formGroup.get("type")?.setValue(this.typesOptions[0].value),this.invoiceTypeChanged(this.typesOptions[0].value);break;default:this.formGroup.removeControl("numberOfCashBill"),this.formGroup.get("currency")?.setValue(this.settings?.invoiceCurrency),this.setFocusOn("currency"),this.formGroup.get("methodOfPayment")?.setValue(this.settings?.invoiceMethodOfPayment)}this.isEdit||this.setInvoiceNumber()})}setInvoiceNumber(){this.webService.getNextInvoiceNumber(this.formGroup.get("type")?.value,this.formGroup.get("dateOfCreate")?.value).subscribe(t=>{this.formGroup.get("number")?.setValue(t+"/"+new Date(this.formGroup.get("dateOfCreate")?.value).getFullYear().toString())})}createBuyer(){this.buyerCreateEditPopupService.openDialog().subscribe(t=>{t&&this.listEntities.requestFirstPage()})}changeIsInvoiceTaxFree(){const t=this.formGroup.get("comment"),n=t?.value||"";this.isInvoiceTaxFree?(this.invoiceItemsFormArr.controls.forEach((o,r)=>{o.get("vatRate")?.setValue(0),this.calculateInvoiceItemAmount(r,"vatRate")}),this.settings?.invoiceTaxFreeText&&n.includes(this.settings?.invoiceTaxFreeText)||t?.setValue(n+(n.length>0?", ":"")+this.settings?.invoiceTaxFreeText)):(this.invoiceItemsFormArr.controls.forEach((o,r)=>{o.get("vatRate")?.setValue(this.settings?.invoiceVatRate),this.calculateInvoiceItemAmount(r,"vatRate")}),this.settings?.invoiceTaxFreeText&&n.includes(this.settings.invoiceTaxFreeText)&&t?.setValue(n.replace(this.settings.invoiceTaxFreeText,"")))}calculateInvoiceItemAmount(t,n){let o=this.invoiceItemsFormArr.controls[t].get("quantity"),r=1*o?.value,s=this.invoiceItemsFormArr.controls[t].get("pricePerUnit"),u=1*s?.value,d=this.invoiceItemsFormArr.controls[t].get("netPrice"),p=1*d?.value,g=1*this.invoiceItemsFormArr.controls[t].get("vatRate")?.value,C=this.invoiceItemsFormArr.controls[t].get("vatAmount"),_=1*C?.value,x=this.invoiceItemsFormArr.controls[t].get("grossPrice"),T=1*x?.value;switch(n){case"quantity":case"pricePerUnit":p=r*u,d?.setValue((0,m.wz)(p)),_=p*g/100,C?.setValue((0,m.wz)(_)),x?.setValue((0,m.wz)(p+_));break;case"netPrice":r<=0&&(r=1,o?.setValue(r)),u=p/r,s?.setValue((0,m.wz)(u)),_=p*g/100,C?.setValue((0,m.wz)(_)),x?.setValue((0,m.wz)(p+_));break;case"vatRate":_=p*g/100,C?.setValue((0,m.wz)(_)),x?.setValue((0,m.wz)(p+_));break;case"vatAmount":p=100*_/g,d?.setValue((0,m.wz)(p)),r<=0&&(r=1,o?.setValue(r)),u=p/r,s?.setValue((0,m.wz)(u)),x?.setValue((0,m.wz)(p+_));break;case"grossPrice":_=T*g/(100+g),C?.setValue((0,m.wz)(_)),p=T-_,d?.setValue((0,m.wz)(p)),r<=0&&(r=1,o?.setValue(r)),u=p/r,s?.setValue((0,m.wz)(u))}this.calculateInvoiceAmount()}calculateInvoiceAmount(){setTimeout(()=>{let t=0,n=0,o=0,r=0;this.invoiceItemsFormArr.value.forEach(s=>{t+=s.netPrice,o+=s.vatAmount,r+=s.grossPrice,s.vatRate>n&&(n=s.vatRate)}),this.formGroup.get("netAmount")?.setValue((0,m.wz)(t)),this.formGroup.get("vatRate")?.setValue((0,m.wz)(n)),this.formGroup.get("vatAmount")?.setValue((0,m.wz)(o)),this.formGroup.get("grossAmount")?.setValue((0,m.wz)(r))})}setAllInvoiceAmounts(){this.invoiceItemsFormArr.controls.forEach(t=>{const n=1*t.get("grossPrice")?.value,o=1*t.get("vatAmount")?.value,r=1*t.get("vatRate")?.value;t.get("grossPrice")?.setValue((0,m.wz)(n)),t.get("vatAmount")?.setValue((0,m.wz)(n*r/(100+r))),t.get("netPrice")?.setValue((0,m.wz)(n-o))}),this.calculateInvoiceAmount()}autoImport(){this.workOrderSelectionComponentService.openDialog(this.selectedBuyer?.oid||"",[]).subscribe(n=>{n&&this.addWorkOrderToNewInvoiceItem(n)})}getAllImportedWorkOrderItemOIDS(){const t=[];return this.invoiceItemsFormArr.controls.forEach((n,o)=>{this.getWorkOrderItemsFormArr(o).controls.forEach(r=>{t.push(r.value.oid)})}),t}searchHandler(t){let n=new G.h;n.criteriaQuick=t,this.listEntities.setFilter(n)}searchHandlerOnChange(t){let n=new G.h;n.criteriaQuick=t,this.listEntitiesOnChange.setFilter(n)}importInvoiceFrom(t,n){this.webService.getEntityByOid(n).subscribe(o=>{"advanceInvoice"===t?this.advanceInvoice=o:this.preInvoice=o,this.selectedBuyer=o.buyer,this.initializeCreate("advanceInvoice"===t),console.log({...this.formGroup.get("comment")?.value});let r="";const s={invoiceNumber:o.number,invoiceDate:new Date(o.dateOfCreate).getDate()+"/"+(new Date(o.dateOfCreate).getMonth()+1)+"/"+new Date(o.dateOfCreate).getFullYear()};r=this.translateService.instant("advanceInvoice"===t?"invoiceCreatedOnAdvanceInvoice":"invoiceCreatedOnPreInvoice",s),o.comment&&(r+=". "+o.comment+"."),this.formGroup.get("comment")?.setValue(this.formGroup.get("comment")?.value+r),o.invoiceItems.forEach((u,d)=>{u.oid="",u.workOrderItems=[],this.addNewItem(u)}),this.formGroup.markAsDirty()})}bottomReachedHandlerBuyers(){this.listEntities.requestNextPage()}bottomReachedHandlerBuyersOnChange(){this.listEntitiesOnChange.requestNextPage()}consolidateAllDates(){this.formGroup.get("dateOfTurnover")?.setValue(this.formGroup.get("dateOfCreate")?.value),this.formGroup.get("dateOfMaturity")?.setValue(this.formGroup.get("dateOfCreate")?.value)}onKeypress(t,n,o=-1){if("Enter"===t.key)switch(t.preventDefault(),n){case"numberOfCashBill":this.setFocusOn("currency");break;case"currency":this.setFocusOn("number");break;case"number":this.setFocusOn("buyer");break;case"dateOfCreate":this.setFocusOn("dateOfTurnover");break;case"dateOfTurnover":this.setFocusOn("dateOfMaturity");break;case"dateOfMaturity":this.setFocusOn("country");break;case"country":this.setFocusOn("placeOfIssue");break;case"placeOfIssue":this.setFocusOn("methodOfPayment");break;case"methodOfPayment":this.setFocusOn("description",0,!0);break;case"description":this.setFocusOn("uom",o);break;case"uom":this.setFocusOn("quantity",o,!0);break;case"quantity":this.setFocusOn("pricePerUnit",o,!0);break;case"pricePerUnit":this.setFocusOn("netPrice",o,!0);break;case"netPrice":this.setFocusOn("vatRate",o,!0);break;case"vatRate":this.setFocusOn("vatAmount",o,!0);break;case"vatAmount":this.setFocusOn("grossPrice",o,!0);break;case"grossPrice":this.invoiceItemsFormArr.length===o+1&&this.addNewItem(),setTimeout(()=>{this.setFocusOn("description",o+1)})}}setFocusOn(t,n=0,o=!1){const r=this.el.nativeElement.querySelectorAll('[formcontrolname="'+t+'"]')[n<0?0:n];r?.focus(),o&&r.select()}openedToggleOnUomSelect(t,n){!t&&this.getUOM(n)?.value&&this.uomChanged(this.getUOM(n)?.value,n)}uomChanged(t,n){setTimeout(()=>{this.setFocusOn("quantity",n,!0)})}getFilteredOptions(t){return this.filteredOptions[t]}addNote(t){this.notesFormArr.push(new c.nJ({oid:new c.p4(t?.oid||""),name:new c.p4(t?.name||"",[c.kI.required]),description:new c.p4(t?.description||"",[c.kI.required])}))}removeNote(t){this.notesFormArr.removeAt(t)}generateXMLFile(){this.invoiceOID&&(this.subs.sink=this.webService.getXMLForInvoice(this.invoiceOID).subscribe(t=>{const n="XML_"+this.translateService.instant("invoiceNumber")+"_"+this.formGroup.get("number")?.value||0;this.saveTextAsFile(t.xmlText,n+".xml")}))}registrate(){this.invoiceOID&&(this.subs.sink=this.webService.registrationOfInvoice(this.invoiceOID).subscribe(t=>{t&&this.globalService.showBasicAlert(b.I.success,this.translateService.instant("successfully"),this.translateService.instant("invoiceIsSuccessfullyRegistrated"))}))}getInvoiceFromSEF(){this.invoiceOID&&this.webService.downloadFile(this.invoiceOID).subscribe(t=>{const n=new Blob([t],{type:"application/pdf"}),o=URL.createObjectURL(n);window.open(o)})}saveTextAsFile(t,n){if(t){n||(n="invoice.xml");var o=new Blob([t],{type:"xml"}),r=document.createEvent("MouseEvents"),s=document.createElement("a");r=document.createEvent("MouseEvents"),(s=document.createElement("a")).download=n,s.href=window.URL.createObjectURL(o),s.dataset.downloadurl=["text/plain",s.download,s.href].join(":"),r.initEvent("click",!0,!1),s.dispatchEvent(r)}else console.error("Console.save: No data")}ngOnDestroy(){this.inputSearchControlSubscription.unsubscribe(),this.inputSearchControlOnChangeSubscription.unsubscribe(),this.subs.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Z.F0),e.Y36(Z.gz),e.Y36(ye.U),e.Y36(L.b),e.Y36(I.o),e.Y36(J.e),e.Y36(F.X),e.Y36(be.G),e.Y36(v.sK),e.Y36(O.y),e.Y36(O.y),e.Y36(e.SBq),e.Y36(H),e.Y36(K),e.Y36(Ae.T),e.Y36(ke.g))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-invoice-create-edit"]],inputs:{debounceTime:"debounceTime"},features:[e._Bn([L.b,F.X,J.e,oe.u,O.y,I.o,H,K])],decls:10,vars:7,consts:[[1,"wrapper"],[1,"container"],[1,"title"],[4,"ngIf"],["class","form",3,"formGroup",4,"ngIf"],["class","button-section",4,"ngIf"],[1,"form",3,"formGroup"],[1,"row"],["formControlName","type",3,"disabled","valueChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","matInput","","formControlName","currency",3,"keypress"],["type","text","matInput","","formControlName","number",3,"keypress"],[1,"bottom-padding",3,"isTransparentMode","text","clickEvent"],["formControlName","buyer","msInfiniteScroll","",3,"disabled","compareWith","matTooltip","valueChange","infiniteScroll","selectionChange"],[3,"formControl","placeholderLabel","noEntriesFoundLabel","hideClearSearchButton","clearSearchInput","searching","disableScrollToActiveOnOptionsChanged"],[3,"value",4,"ngIf"],[4,"ngFor","ngForOf"],["class","create-buyer-button",3,"iconName","disabled","clickEvent",4,"ngIf"],["class","create-buyer-button",3,"color","ngModel","ngModelOptions","ngModelChange",4,"ngIf"],[1,"create-buyer-button",3,"color","ngModel","ngModelOptions","ngModelChange","change"],["type","date","matInput","","formControlName","dateOfCreate",3,"change","keypress"],["type","date","matInput","","formControlName","dateOfTurnover",3,"keypress"],["type","date","matInput","","formControlName","dateOfMaturity",3,"keypress"],["type","text","matInput","","formControlName","country",3,"keypress"],["type","text","matInput","","formControlName","placeOfIssue",3,"keypress"],["type","text","matInput","","formControlName","methodOfPayment",3,"keypress"],["formArrayName","invoiceItems","class","invoice-items",4,"ngIf"],[1,"buttons"],[1,"big-button",3,"iconName","text","disabled","clickEvent"],[1,"big-button",3,"iconName","text","isTransparentMode","disabled","clickEvent"],["matInput","","formControlName","comment","rows","3",3,"keypress"],["type","text","appDecimal","","matInput","","formControlName","netAmount",3,"readonly"],["type","text","appDecimal","","matInput","","formControlName","vatRate",3,"readonly"],["type","text","appDecimal","","matInput","","formControlName","vatAmount",3,"readonly"],["type","text","appDecimal","","matInput","","formControlName","grossAmount",3,"readonly"],["class","notes","formArrayName","notes",4,"ngIf"],[3,"value"],["type","text","matInput","","formControlName","numberOfCashBill",3,"keypress"],[1,"create-buyer-button",3,"iconName","disabled","clickEvent"],[1,"create-buyer-button",3,"color","ngModel","ngModelOptions","ngModelChange"],["msInfiniteScroll","",3,"compareWith","infiniteScroll","selectionChange"],["formArrayName","invoiceItems",1,"invoice-items"],["class","invoice-item",4,"ngFor","ngForOf"],[1,"invoice-item"],[1,"form-group",3,"formGroupName"],[1,"full-width"],["type","text","matInput","","formControlName","description",3,"matAutocomplete","matTooltip","keydown.enter","keypress"],["trigger","matAutocompleteTrigger"],["auto","matAutocomplete"],[1,"number-field"],["formControlName","uom",1,"color-black",3,"openedChange"],["type","text","appDecimal","","matInput","","formControlName","quantity",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","pricePerUnit",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","netPrice",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","vatRate",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","vatAmount",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","grossPrice",3,"keypress","change","focusout"],[1,"additional-button",3,"text","clickEvent"],[1,"additional-button",3,"iconName","isTransparentMode","clickEvent"],["formArrayName","workOrderItems","multiple","",3,"value"],[3,"value","click",4,"ngFor","ngForOf"],[3,"value","click"],["type","text","appDecimal","","matInput","","formControlName","advancePayAmount"],["formArrayName","notes",1,"notes"],["class","row",4,"ngFor","ngForOf"],[3,"text","clickEvent"],["type","text","matInput","","formControlName","name"],["type","text","matInput","","formControlName","description"],[1,"button-section"],["color","secondary",1,"cancel",3,"text","clickEvent"],[1,"update",3,"text","disabled","clickEvent"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),e._uU(4),e.ALo(5,"translate"),e.YNc(6,Te,3,4,"span",3),e.YNc(7,Me,3,4,"span",3),e.qZA()(),e.YNc(8,$e,107,161,"form",4),e.qZA(),e.YNc(9,Xe,11,19,"div",5),e.qZA()),2&t&&(e.xp6(4),e.hij(" ",e.lcZ(5,5,n.isEdit?"editInvoice":"createInvoice")," "),e.xp6(2),e.Q6J("ngIf",n.preInvoice),e.xp6(1),e.Q6J("ngIf",n.advanceInvoice),e.xp6(1),e.Q6J("ngIf",n.formGroup),e.xp6(1),e.Q6J("ngIf",n.formGroup))},dependencies:[h.sg,h.O5,E.r,c._Y,c.Fj,c.JJ,c.JL,c.oH,c.sg,c.u,c.x0,c.CE,k.KE,k.hX,R.Nt,w.gD,Ze.ey,Y.nu,V.gM,z.s,we.U,P.XC,P.ZL,y.oG,c.On,h.Ov,v.X$],styles:[".wrapper[_ngcontent-%COMP%]{height:100%}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;height:calc(100% - 100px);overflow-y:auto}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;border-bottom:2px dotted var(--color-main-light)}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{flex-direction:column;margin-top:20px;display:flex;width:100%;color:var(--color-black)}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .create-buyer-button[_ngcontent-%COMP%]{margin:10px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .import-buttons[_ngcontent-%COMP%]{display:flex;margin:10px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .import-buttons[_ngcontent-%COMP%]   app-button[_ngcontent-%COMP%]{margin-right:20px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .bottom-padding[_ngcontent-%COMP%]{display:flex;align-items:center;padding-bottom:1.34375em;margin-left:20px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .invoice-items[_ngcontent-%COMP%]   .invoice-item[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .invoice-items[_ngcontent-%COMP%]   .invoice-item[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{flex-grow:1}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .invoice-items[_ngcontent-%COMP%]   .invoice-item[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .number-field[_ngcontent-%COMP%]{flex-shrink:1;max-width:100px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .big-button[_ngcontent-%COMP%]{margin-right:20px}.wrapper[_ngcontent-%COMP%]   .button-section[_ngcontent-%COMP%]{display:flex;width:100%;height:60px;flex-direction:row;align-items:center;justify-content:space-between}.additional-button[_ngcontent-%COMP%]{margin:10px 5px}"]}),i})(),canActivate:[ne.Y],data:{permission:"INVOICE_CREATE"}}];let tt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Z.Bz.forChild(et),Z.Bz]}),i})();var S=l(2024),nt=l(7707),ot=l(7331),q=l(4494),it=l(7392),rt=l(7012),X=l(6460),ee=l(8287);let st=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.ez,q.p,y.p9,v.aw]}),i})(),ct=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.ez,f.Is,S.h,v.aw,X.n,k.lN,w.LD,ee.n,st,j.Cq]}),i})(),at=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.ez,f.Is,S.h,v.aw,X.n,k.lN,w.LD,ee.n,q.p,y.p9,c.u5]}),i})(),lt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.ez,tt,v.aw,S.h,nt.R,c.UX,R.c,k.lN,w.LD,ot.Hi,q.p,it.Ps,Y.Co,V.AV,z.I,rt.o,P.Bb,y.p9,ct,at,c.u5]}),i})()}}]);