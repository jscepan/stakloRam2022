"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[731],{1731:(V,p,i)=>{i.r(p),i.d(p,{DebtViewModule:()=>S});var u=i(9808),c=i(119),f=i(2024),A=i(8966),Z=i(3497),_=i(6460),l=i(8287),h=i(4655),a=i(3679),T=i(4463),x=i(2134),M=i(29),C=i(1558),t=i(7716),w=i(7322),D=i(3194),U=i(42);function L(r,d){if(1&r){const e=t.EpF();t.TgZ(0,"form",6),t.TgZ(1,"mat-form-field"),t.TgZ(2,"mat-label"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"input",7),t.NdJ("change",function(){return t.CHM(e),t.oxw().dateChange()}),t.qZA(),t.qZA(),t.TgZ(6,"mat-form-field"),t.TgZ(7,"mat-label"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._UZ(10,"input",8),t.qZA(),t.TgZ(11,"app-button",9),t.NdJ("clickEvent",function(){return t.CHM(e),t.oxw().currentYear()}),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"app-button",10),t.NdJ("clickEvent",function(){return t.CHM(e),t.oxw().viewDebtor()}),t.ALo(14,"translate"),t.qZA(),t.qZA()}if(2&r){const e=t.oxw();t.Q6J("formGroup",e.formGroup),t.xp6(2),t.ekj("mark-required",!0)("mark-opt-required",!0),t.xp6(1),t.hij(" ",t.lcZ(4,14,"fromDate")," "),t.xp6(4),t.ekj("mark-required",!0)("mark-opt-required",!0),t.xp6(1),t.hij(" ",t.lcZ(9,16,"toDate")," "),t.xp6(3),t.Q6J("text",t.lcZ(12,18,"currentYear")),t.xp6(2),t.Q6J("text",t.lcZ(14,20,"view"))("disabled",!(e.formGroup.dirty&&e.formGroup.valid))}}function P(r,d){if(1&r&&(t.ynx(0),t.TgZ(1,"div",3),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"div",3),t._uU(5),t.qZA(),t.TgZ(6,"div",2),t._uU(7),t.ALo(8,"number"),t.qZA(),t.TgZ(9,"div",2),t._uU(10),t.ALo(11,"number"),t.qZA(),t.TgZ(12,"div",2),t._uU(13),t.ALo(14,"number"),t.qZA(),t.BQk()),2&r){const e=d.$implicit;t.xp6(2),t.Oqu(t.xi3(3,5,e.date,"dd.MM.yyyy")),t.xp6(3),t.Oqu(e.description),t.xp6(2),t.hij(" ",t.Dn7(8,8,e.owed,"1.2-2","de")," "),t.xp6(3),t.hij(" ",t.Dn7(11,12,e.debt,"1.2-2","de")," "),t.xp6(3),t.hij(" ",t.Dn7(14,16,e.state,"1.2-2","de")," ")}}function E(r,d){if(1&r&&(t.TgZ(0,"div",11),t.TgZ(1,"div",12),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",12),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",12),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"div",12),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"div",12),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"div",3),t._uU(17,"-"),t.qZA(),t.TgZ(18,"div",3),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"div",2),t._uU(22),t.ALo(23,"number"),t.qZA(),t.TgZ(24,"div",2),t._uU(25),t.ALo(26,"number"),t.qZA(),t.TgZ(27,"div",2),t._uU(28),t.ALo(29,"number"),t.qZA(),t.YNc(30,P,15,20,"ng-container",13),t.TgZ(31,"div",14),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"div",15),t._uU(35),t.ALo(36,"number"),t.qZA(),t.TgZ(37,"div",15),t._uU(38),t.ALo(39,"number"),t.qZA(),t.TgZ(40,"div",15),t._uU(41),t.ALo(42,"number"),t.qZA(),t.qZA()),2&r){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,14,"date")),t.xp6(3),t.Oqu(t.lcZ(6,16,"description")),t.xp6(3),t.Oqu(t.lcZ(9,18,"owed")),t.xp6(3),t.Oqu(t.lcZ(12,20,"debt")),t.xp6(3),t.Oqu(t.lcZ(15,22,"state")),t.xp6(5),t.Oqu(t.lcZ(20,24,"startAmount")),t.xp6(3),t.hij(" ",t.Dn7(23,26,e.debtView.startAmount>=0?e.debtView.startAmount:0,"1.2-2","de")," "),t.xp6(3),t.hij(" ",t.Dn7(26,30,e.debtView.startAmount<0?e.debtView.startAmount:0,"1.2-2","de")," "),t.xp6(3),t.hij(" ",t.Dn7(29,34,e.debtView.startAmount,"1.2-2","de")," "),t.xp6(2),t.Q6J("ngForOf",e.debtView.transactions),t.xp6(2),t.hij(" ",t.lcZ(33,38,"turnover"),": "),t.xp6(3),t.hij(" ",t.Dn7(36,40,e.debtView.debtSum+(e.debtView.startAmount>0?e.debtView.startAmount:0),"1.2-2","de")," "),t.xp6(3),t.hij(" ",t.Dn7(39,44,e.debtView.owedSum+(e.debtView.startAmount<0?e.debtView.startAmount:0),"1.2-2","de")," "),t.xp6(3),t.hij(" ",t.Dn7(42,48,e.debtView.debtSum+e.debtView.owedSum+e.debtView.startAmount,"1.2-2","de")," ")}}const q=[{path:"",component:(()=>{class r{constructor(e,o,s){this.webService=e,this.route=o,this.translateService=s,this.subs=new T.L,this.buyerOID=null,this.isLoading=!0,this.formGroup=new a.cw({fromDate:new a.NI("",[a.kI.required]),toDate:new a.NI("",[a.kI.required])})}ngOnInit(){this.buyerOID=this.route.snapshot.paramMap.get("buyerOID"),this.buyerOID&&(this.subs.sink=this.webService.getDebtor(this.buyerOID).subscribe(e=>{this.entity=e,this.isLoading=!1,this.convertDebtorToTransactions()}))}currentYear(){var e,o;null===(e=this.formGroup.get("fromDate"))||void 0===e||e.setValue((new Date).getFullYear()+"-01-01"),null===(o=this.formGroup.get("toDate"))||void 0===o||o.setValue((new Date).toISOString().substring(0,10)),this.formGroup.markAsDirty()}dateChange(){var e,o,s,m;const g=null===(e=this.formGroup.get("fromDate"))||void 0===e?void 0:e.value,b=null===(o=this.formGroup.get("toDate"))||void 0===o?void 0:o.value;(g&&!b||g&&b&&new Date(b)<new Date(g))&&(null===(s=this.formGroup.get("toDate"))||void 0===s||s.setValue(null===(m=this.formGroup.get("fromDate"))||void 0===m?void 0:m.value))}viewDebtor(){var e,o;this.convertDebtorToTransactions(null===(e=this.formGroup.get("fromDate"))||void 0===e?void 0:e.value,null===(o=this.formGroup.get("toDate"))||void 0===o?void 0:o.value)}convertDebtorToTransactions(e,o){var s,m,g,b,O,y;this.debtView={startAmount:0,owedSum:0,debtSum:0,transactions:[]};const v=!!e&&!!o;null===(m=null===(s=this.entity)||void 0===s?void 0:s.invoices)||void 0===m||m.forEach(n=>{!v||v&&e&&o&&e<=n.dateOfCreate&&n.dateOfCreate<=o?(this.debtView.transactions.push({date:n.dateOfCreate,description:this.translateService.instant((0,x.YQ)(n.type))+": "+n.number,owed:n.grossAmount,debt:0,state:0}),this.debtView.debtSum+=n.grossAmount):e&&e>n.dateOfCreate&&(this.debtView.startAmount+=n.grossAmount)}),null===(b=null===(g=this.entity)||void 0===g?void 0:g.incomes)||void 0===b||b.forEach(n=>{!v||v&&e&&o&&e<=n.date&&n.date<=o?(this.debtView.transactions.push({date:n.date,description:this.translateService.instant("income")+(n.comment?", "+n.comment:"")+(n.bankStatementNumber?", Izvod: "+n.bankStatementNumber:""),debt:n.amount,owed:0,state:0}),this.debtView.owedSum-=n.amount):e&&e>n.date&&(this.debtView.startAmount-=n.amount)}),null===(y=null===(O=this.entity)||void 0===O?void 0:O.outcomes)||void 0===y||y.forEach(n=>{!v||v&&e&&o&&e<=n.date&&n.date<=o?(this.debtView.transactions.push({date:n.date,description:this.translateService.instant("outcome")+", "+n.comment,owed:n.amount,debt:0,state:0}),this.debtView.debtSum+=n.amount):e&&e>n.date&&(this.debtView.startAmount+=n.amount)}),this.debtView.transactions=this.debtView.transactions.sort((n,j)=>Number(new Date(n.date))-Number(new Date(j.date)));for(let n=0;n<this.debtView.transactions.length;n++)this.debtView.transactions[n].state=0===n?this.debtView.transactions[n].owed-this.debtView.transactions[n].debt+this.debtView.startAmount:this.debtView.transactions[n-1].state+this.debtView.transactions[n].owed-this.debtView.transactions[n].debt}ngOnDestroy(){this.subs.unsubscribe()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(C.X),t.Y36(h.gz),t.Y36(c.sK))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-debt-view"]],features:[t._Bn([M.N,C.X])],decls:19,vars:14,consts:[[1,"container"],[1,"title","grid-container","standard-grid-table"],[1,"grid-item","align-right"],[1,"grid-item"],["class","form",3,"formGroup",4,"ngIf"],["class","grid-container standard-grid-table",4,"ngIf"],[1,"form",3,"formGroup"],["type","date","matInput","","formControlName","fromDate",3,"change"],["type","date","matInput","","formControlName","toDate"],[1,"view-button","no-print",3,"text","clickEvent"],[1,"view-button","no-print",3,"text","disabled","clickEvent"],[1,"grid-container","standard-grid-table"],[1,"grid-item","header"],[4,"ngFor","ngForOf"],[1,"grid-item","colspan2","top-border","bold"],[1,"grid-item","align-right","top-border","bold"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div",3),t._uU(6),t.qZA(),t.TgZ(7,"div",2),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"div",3),t._uU(11),t.qZA(),t.TgZ(12,"div",2),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"div",3),t._uU(16),t.qZA(),t.qZA(),t.YNc(17,L,15,22,"form",4),t.YNc(18,E,43,52,"div",5),t.qZA()),2&e&&(t.xp6(3),t.hij("",t.lcZ(4,8,"company"),":"),t.xp6(3),t.Oqu(null==o.entity||null==o.entity.buyer?null:o.entity.buyer.name),t.xp6(2),t.hij("",t.lcZ(9,10,"address"),":"),t.xp6(3),t.Oqu(null==o.entity||null==o.entity.buyer?null:o.entity.buyer.address),t.xp6(2),t.hij("",t.lcZ(14,12,"pib"),":"),t.xp6(3),t.Oqu(null==o.entity||null==o.entity.buyer?null:o.entity.buyer.pib),t.xp6(1),t.Q6J("ngIf",o.formGroup),t.xp6(1),t.Q6J("ngIf",o.debtView))},directives:[u.O5,a._Y,a.JL,a.sg,w.KE,w.hX,D.Nt,a.Fj,a.JJ,a.u,U.r,u.sg],pipes:[c.X$,u.JJ,u.uU],styles:[".container[_ngcontent-%COMP%]{height:calc(100%)}.container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:600}.container[_ngcontent-%COMP%]   .title.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto auto}.container[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.container[_ngcontent-%COMP%]   .grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto auto auto auto auto;overflow-y:hidden}.container[_ngcontent-%COMP%]   .grid-container[_ngcontent-%COMP%]   .grid-item.colspan2[_ngcontent-%COMP%]{grid-column:1/span 2}.container[_ngcontent-%COMP%]   .grid-container[_ngcontent-%COMP%]   .grid-item.colspan3[_ngcontent-%COMP%]{grid-column:1/span 3}.container[_ngcontent-%COMP%]   .grid-container[_ngcontent-%COMP%]   .grid-item.top-border[_ngcontent-%COMP%]{border-top:1px solid var(--color-black)}.container[_ngcontent-%COMP%]   .grid-container[_ngcontent-%COMP%]   .grid-item.bold[_ngcontent-%COMP%]{font-weight:600}.view-button[_ngcontent-%COMP%]{margin-left:20px}@media print{.no-print[_ngcontent-%COMP%]{display:none!important}}"]}),r})(),data:{permission:"DEBTOR_VIEW"}}];let I=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[h.Bz.forChild(q)],h.Bz]}),r})(),S=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[u.ez,I,c.aw,f.h,A.Is,Z.N,_.n,l.n,a.UX,D.c,w.lN]]}),r})()},9360:(V,p,i)=>{i.d(p,{K:()=>c});var u=i(8228);class c extends u.g{constructor(){super(...arguments),this.description=""}}},29:(V,p,i)=>{i.d(p,{N:()=>_});var u=i(4292),c=i(136),f=i(9360),A=i(7716),Z=i(7515);let _=(()=>{class l extends u.h{constructor(a){super(a,f.K,c.HT),this.baseWebService=a}}return l.\u0275fac=function(a){return new(a||l)(A.LFG(Z.I))},l.\u0275prov=A.Yz7({token:l,factory:l.\u0275fac}),l})()}}]);