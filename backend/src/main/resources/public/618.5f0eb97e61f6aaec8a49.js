"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[618],{9618:(xt,Y,d)=>{d.r(Y),d.d(Y,{InvoiceCreateEditModule:()=>Ct});var C=d(9808),P=d(4655),me=d(7095),c=d(3679),R=d(1217),N=d(4794),M=d(4463),V=d(7379),pe=d(6254),G=d(7342),S=d(136),x=d(2134),Z=d(5595),$=d(287),z=d(4395),_e=d(9761),ve=d(8002),T=d(2050),O=d(8966),K=d(7574),X=d(6215),ee=d(8939),e=d(7716),te=d(4286),F=d(42),ne=d(773),w=d(7446),A=d(4333);const ge=function(i){return{selected:i}};let he=(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-work-order-selection-item"]],inputs:{dataModel:"dataModel"},features:[e._Bn([])],decls:31,vars:27,consts:[[1,"item-card",3,"ngClass"],[1,"container"],[1,"number"],[1,"date"],[1,"bold"],[1,"for-person"],[1,"value"],[1,"note"],[1,"description"],[1,"checkbox"],["name","Primary","color","primary",3,"checked"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"span"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.qZA(),e.TgZ(6,"div",3),e.TgZ(7,"span",4),e._uU(8),e.ALo(9,"translate"),e.qZA(),e._uU(10),e.ALo(11,"date"),e.qZA(),e.TgZ(12,"div",5),e.TgZ(13,"div",6),e.TgZ(14,"span",4),e._uU(15),e.ALo(16,"translate"),e.qZA(),e._uU(17),e.qZA(),e.qZA(),e.TgZ(18,"div",7),e.TgZ(19,"div",6),e.TgZ(20,"span",4),e._uU(21),e.ALo(22,"translate"),e.qZA(),e._uU(23),e.qZA(),e.qZA(),e.TgZ(24,"div",8),e.TgZ(25,"span",4),e._uU(26),e.ALo(27,"translate"),e.qZA(),e._uU(28),e.qZA(),e.qZA(),e.TgZ(29,"div",9),e._UZ(30,"mat-checkbox",10),e.qZA(),e.qZA()),2&t&&(e.Q6J("ngClass",e.VKq(25,ge,n.dataModel.selected)),e.xp6(4),e.AsE("",e.lcZ(5,12,"nr"),": ",n.dataModel.number,""),e.xp6(4),e.Oqu(e.lcZ(9,14,"date")),e.xp6(2),e.hij(": ",e.xi3(11,16,n.dataModel.date,"dd.MM.yyyy")," "),e.xp6(5),e.Oqu(e.lcZ(16,19,"forPerson")),e.xp6(2),e.hij(": ",n.dataModel.forPerson," "),e.xp6(4),e.Oqu(e.lcZ(22,21,"note")),e.xp6(2),e.hij(": ",n.dataModel.note," "),e.xp6(3),e.Oqu(e.lcZ(27,23,"description")),e.xp6(2),e.hij(": ",n.dataModel.description," "),e.xp6(2),e.Q6J("checked",n.dataModel.selected||!1))},directives:[C.mk,w.oG],pipes:[A.X$,C.uU],styles:[".item-card[_ngcontent-%COMP%]{display:flex;cursor:pointer;transition:transform .5s ease;width:200px;height:200px;background-color:var(--color-white);position:relative;box-shadow:0 4px 4px #0000001a;border-radius:6px;border:1px solid var(--color-main-light, #bbbbbb);width:150px;height:150px;margin:10px}.item-card[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{position:absolute;width:100%;display:flex;flex-direction:column;margin-top:5px;width:150px;height:140px}.item-card[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{font-weight:600;margin:5px 0;text-align:center}.item-card[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{flex-grow:1;overflow:hidden;width:100%;height:100%}.item-card[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;position:absolute;z-index:1;margin-top:10px;margin-left:130px}.item-card.selected[_ngcontent-%COMP%]{opacity:.7}.item-card[_ngcontent-%COMP%]:hover{transform:scale(1.15)}.value[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.bold[_ngcontent-%COMP%]{font-weight:600}"]}),i})();function fe(i,a){1&i&&(e.TgZ(0,"div",7),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"noResults")," "))}function Ce(i,a){1&i&&(e.TgZ(0,"div",8),e._UZ(1,"mat-spinner"),e.qZA())}function xe(i,a){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-work-order-selection-item",9),e.NdJ("click",function(){const r=e.CHM(t).$implicit;return e.oxw(2).handleItemClick(r.item)}),e.qZA(),e.BQk()}if(2&i){const t=a.$implicit;e.xp6(1),e.Q6J("dataModel",t.item)}}function Oe(i,a){if(1&i&&(e.ynx(0),e.YNc(1,fe,3,3,"div",4),e.ALo(2,"async"),e.YNc(3,Ce,2,0,"div",5),e.ALo(4,"async"),e.YNc(5,xe,2,1,"ng-container",6),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",0===t.totalEntitiesLength&&!e.lcZ(2,3,t.isLoading)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,5,t.isLoading)),e.xp6(2),e.Q6J("ngForOf",t.items)}}function Ie(i,a){1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"youDidntSelectAnyBuyer")))}let ye=(()=>{class i{constructor(t,n,o,r,s){this.dialogRef=t,this.data=n,this.cdRef=o,this.webService=r,this.listEntities=s,this.subs=new M.L,this.buyerOID="",this.invoiceType="",this.excludedOids=[],this.isSingleSelection=!0,this.isLoading$=new X.X(!1),this.isLoading=this.isLoading$.asObservable(),this.totalEntitiesLength=0,this.selection=[],this.items=[],this.buyerOID=n.buyerOID,this.excludedOids=(null==n?void 0:n.excludedOids)||[],this.isSingleSelection=!1!==n.isSingleSelection}ngOnInit(){this.isLoading$.next(!0),this.subs.sink=this.webService.getAllUnsettledWorkOrderForBuyer(this.buyerOID).pipe((0,ee.x)(()=>{this.isLoading$.next(!1)})).subscribe(t=>{this.items=t.map(n=>({item:{oid:n.oid,date:n.dateOfCreate,number:(0,x.Nw)(n),forPerson:n.forPerson,note:n.note,description:n.description},object:n})),this.totalEntitiesLength=this.items.length})}ngAfterViewInit(){this.cdRef.detectChanges()}handleItemClick(t){this.items=this.items.map(n=>this.isSingleSelection?Object.assign(Object.assign({},n),{item:Object.assign(Object.assign({},n.item),{selected:n.item.oid===t.oid})}):n.item.oid===t.oid?Object.assign(Object.assign({},n),{item:Object.assign(Object.assign({},n.item),{selected:!n.item.selected})}):Object.assign({},n)),this.updateSelection()}updateSelection(){this.selection=[],this.items.forEach(t=>{t.item.selected&&this.selection.push(t.item.oid)})}saveSelection(){const t=[];this.items.forEach(n=>{n.item.selected&&t.push(n.object)}),this.dialogRef.close(t)}cancelSaveSelection(){this.dialogRef.close()}bottomReachedHandler(){this.listEntities.requestNextPage()}ngOnDestroy(){this.subs.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(O.so),e.Y36(O.WI),e.Y36(e.sBO),e.Y36(T.o),e.Y36(Z.y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-work-order-selection-popup"]],features:[e._Bn([Z.y,T.o])],decls:8,vars:9,consts:[["scrollToBottom","",3,"bottomReached"],[4,"ngIf"],["color","secondary",3,"text","clickEvent"],["color","primary",3,"text","disabled","clickEvent"],["class","no-results",4,"ngIf"],["class","spinner",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"no-results"],[1,"spinner"],[1,"item",3,"dataModel","click"]],template:function(t,n){1&t&&(e.TgZ(0,"mat-dialog-content",0),e.NdJ("bottomReached",function(){return n.bottomReachedHandler()}),e.YNc(1,Oe,6,7,"ng-container",1),e.YNc(2,Ie,3,3,"ng-container",1),e.qZA(),e.TgZ(3,"mat-dialog-actions"),e.TgZ(4,"app-button",2),e.NdJ("clickEvent",function(){return n.cancelSaveSelection()}),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"app-button",3),e.NdJ("clickEvent",function(){return n.saveSelection()}),e.ALo(7,"translate"),e.qZA(),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.buyerOID),e.xp6(1),e.Q6J("ngIf",!n.buyerOID),e.xp6(2),e.Q6J("text",e.lcZ(5,5,"cancel")),e.xp6(2),e.Q6J("text",e.lcZ(7,7,"import"))("disabled",!n.selection.length))},directives:[O.xY,te.C,C.O5,O.H8,F.r,C.sg,ne.Ou,he],pipes:[A.X$,C.Ov],styles:["mat-dialog-content[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid var(--attributes-border-color, #efeff3);display:flex;flex-wrap:wrap;height:calc(100% - 70px);max-height:100%}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.spacer[_ngcontent-%COMP%]{height:0;flex:1 1}"]}),i})(),oe=(()=>{class i{constructor(t){this._matDialog=t,this.subs=new M.L}openDialog(t,n=[],o=!1){return new K.y(r=>{const s=new O.vA;s.width="80%",s.height="80%",s.data={buyerOID:t,excludedOids:n,isSingleSelection:o},this.subs.sink.$openSelectPopup=this._matDialog.open(ye,s).afterClosed().subscribe(l=>{r.next(l),r.complete()},()=>r.error())})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(O.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var Ae=d(5411);function be(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"i-feather",11),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit;return e.oxw().toggleExpandWorkOrder(o.object.oid)}),e.qZA()}2&i&&e.Q6J("name","plus")}function Ze(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"i-feather",11),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit;return e.oxw().toggleExpandWorkOrder(o.object.oid)}),e.qZA()}2&i&&e.Q6J("name","minus")}function ke(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",16),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.oxw().toggleSelectAll(o,r)}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw(2).$implicit,n=e.oxw();e.Q6J("checked",n.isAllChecked(t)),e.xp6(1),e.Oqu(e.lcZ(2,2,"selectDeselectAll"))}}function Te(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",17),e.NdJ("ngModelChange",function(o){return e.CHM(t).$implicit.selected=o})("change",function(){return e.CHM(t),e.oxw(3).updateSelection()}),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()}if(2&i){const t=a.$implicit,n=e.oxw(3);e.Q6J("ngModel",t.selected),e.xp6(1),e.HOy(" ",t.object.description," ",e.lcZ(2,5,"pieces"),": ",t.object.sumQuantity," ",e.lcZ(3,7,n.getUOMDisplayValue(t.object.uom))," ")}}function we(i,a){if(1&i&&(e.TgZ(0,"div",12),e.TgZ(1,"div",13),e.YNc(2,ke,3,4,"mat-checkbox",14),e.YNc(3,Te,4,9,"mat-checkbox",15),e.qZA(),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("ngIf",t.workOrderItems.length>1),e.xp6(1),e.Q6J("ngForOf",t.workOrderItems)}}function Me(i,a){if(1&i&&(e.TgZ(0,"div",5),e.TgZ(1,"div",6),e.TgZ(2,"div",7),e.YNc(3,be,1,1,"i-feather",8),e.YNc(4,Ze,1,1,"i-feather",8),e.qZA(),e.TgZ(5,"div",9),e._uU(6),e.ALo(7,"translate"),e.ALo(8,"translate"),e.ALo(9,"translate"),e.ALo(10,"date"),e.qZA(),e.qZA(),e.YNc(11,we,4,2,"div",10),e.qZA()),2&i){const t=a.$implicit;e.xp6(3),e.Q6J("ngIf",!t.isExpanded),e.xp6(1),e.Q6J("ngIf",t.isExpanded),e.xp6(2),e.hij(" ",e.lcZ(7,4,"workOrder")+" "+e.lcZ(8,6,"nr")+" "+t.object.number+", "+e.lcZ(9,8,"date")+": "+e.xi3(10,10,t.object.dateOfCreate,"dd.MM.yyyy")," "),e.xp6(5),e.Q6J("ngIf",t.isExpanded)}}let Ee=(()=>{class i{constructor(t,n,o,r,s){this.dialogRef=t,this.data=n,this.cdRef=o,this.webService=r,this.listEntities=s,this.subs=new M.L,this.buyerOID="",this.invoiceType="",this.excludedOids=[],this.uomOptions=S.pM,this.getUOMDisplayValue=x.HL,this.isLoading$=new X.X(!1),this.isLoading=this.isLoading$.asObservable(),this.selection=[],this.items=[],this.buyerOID=n.buyerOID,this.excludedOids=(null==n?void 0:n.excludedOids)||[]}ngOnInit(){this.isLoading$.next(!0),this.subs.sink=this.webService.getAllUnsettledWorkOrderForBuyer(this.buyerOID).pipe((0,ee.x)(()=>{this.isLoading$.next(!1)})).subscribe(t=>{this.items=t.map(n=>({oid:n.oid,isExpanded:!1,object:n,workOrderItems:n.workOrderItems.filter(o=>!this.excludedOids.includes(o.oid)).map(o=>({selected:!1,object:o}))}))})}ngAfterViewInit(){this.cdRef.detectChanges()}toggleExpandWorkOrder(t){const n=this.items.findIndex(o=>o.object.oid===t);this.items[n].isExpanded&&(this.items[n].workOrderItems=this.items[n].workOrderItems.map(o=>Object.assign(Object.assign({},o),{selected:!1}))),this.items[n].isExpanded=!this.items[n].isExpanded,this.updateSelection()}updateSelection(){this.selection=[],this.items.forEach(t=>{t.workOrderItems.forEach(n=>{n.selected&&this.selection.push(n.object.oid)})})}saveSelection(){const t=[];this.items.forEach(n=>{let o;n.workOrderItems.forEach(r=>{r.selected&&(o||(o=Object.assign(Object.assign({},n.object),{workOrderItems:[]})),o.workOrderItems.push(r.object))}),o&&t.push(o)}),this.dialogRef.close(t)}cancelSaveSelection(){this.dialogRef.close()}bottomReachedHandler(){this.listEntities.requestNextPage()}toggleSelectAll(t,n){n.workOrderItems.forEach(t.checked?o=>o.selected=!0:o=>o.selected=!1),this.updateSelection()}isAllChecked(t){return t.workOrderItems.filter(n=>!0===n.selected).length===t.workOrderItems.length}ngOnDestroy(){this.subs.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(O.so),e.Y36(O.WI),e.Y36(e.sBO),e.Y36(T.o),e.Y36(Z.y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-work-order-item-selection-popup"]],features:[e._Bn([Z.y,T.o])],decls:8,vars:8,consts:[["scrollToBottom","",3,"bottomReached"],[1,"content"],["class","item",4,"ngFor","ngForOf"],["color","secondary",3,"text","clickEvent"],["color","primary",3,"text","disabled","clickEvent"],[1,"item"],[1,"title"],[1,"icon"],[3,"name","click",4,"ngIf"],[1,"description"],["class","childrens",4,"ngIf"],[3,"name","click"],[1,"childrens"],[1,"child"],["color","primary",3,"checked","change",4,"ngIf"],["color","primary",3,"ngModel","ngModelChange","change",4,"ngFor","ngForOf"],["color","primary",3,"checked","change"],["color","primary",3,"ngModel","ngModelChange","change"]],template:function(t,n){1&t&&(e.TgZ(0,"mat-dialog-content",0),e.NdJ("bottomReached",function(){return n.bottomReachedHandler()}),e.TgZ(1,"div",1),e.YNc(2,Me,12,13,"div",2),e.qZA(),e.qZA(),e.TgZ(3,"mat-dialog-actions"),e.TgZ(4,"app-button",3),e.NdJ("clickEvent",function(){return n.cancelSaveSelection()}),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"app-button",4),e.NdJ("clickEvent",function(){return n.saveSelection()}),e.ALo(7,"translate"),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngForOf",n.items),e.xp6(2),e.Q6J("text",e.lcZ(5,4,"cancel")),e.xp6(2),e.Q6J("text",e.lcZ(7,6,"import"))("disabled",!n.selection.length))},directives:[O.xY,te.C,C.sg,O.H8,F.r,C.O5,Ae.uy,w.oG,c.JJ,c.On],pipes:[A.X$,C.uU],styles:["mat-dialog-content[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid var(--attributes-border-color, #efeff3);display:flex;flex-wrap:wrap;height:calc(100% - 70px);max-height:100%}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow-y:auto;flex-grow:1}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-bottom:1px dotted var(--color-main)}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;color:var(--color-info)}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{display:flex}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .childrens[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-left:40px}mat-dialog-content[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .childrens[_ngcontent-%COMP%]   .child[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.spacer[_ngcontent-%COMP%]{height:0;flex:1 1}"]}),i})(),ie=(()=>{class i{constructor(t){this._matDialog=t,this.subs=new M.L}openDialog(t,n=[]){return new K.y(o=>{const r=new O.vA;r.width="80%",r.height="80%",r.data={buyerOID:t,excludedOids:n},this.subs.sink.$openSelectPopup=this._matDialog.open(Ee,r).afterClosed().subscribe(s=>{o.next(s),o.complete()},()=>o.error())})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(O.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var Pe=d(3851),qe=d(8794),Ne=d(7347),Se=d(5153),Fe=d(8933),E=d(7322),q=d(4107),re=d(3722),se=d(6591),ce=d(7238),Je=d(1862),ae=d(7269),Le=d(3336),J=d(1079);function je(i,a){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.AsE(" - ",e.lcZ(2,2,"madeFromPreinvoiceNr"),": ",t.preInvoice.number,"")}}function Ue(i,a){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.AsE(" - ",e.lcZ(2,2,"madeFromAdvanceinvoiceNr"),": ",t.advanceInvoice.number,"")}}function Be(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.displayName)," ")}}function Qe(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field"),e.TgZ(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"input",37),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw(2).onKeypress(o,"numberOfCashBill")}),e.qZA(),e.qZA()}2&i&&(e.xp6(1),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(3,5,"numberOfCashBill")," "))}function We(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.Q6J("value",t.selectedBuyer),e.xp6(1),e.Oqu(t.selectedBuyer.name)}}function De(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function He(i,a){if(1&i&&(e.ynx(0),e.YNc(1,De,2,2,"mat-option",15),e.BQk()),2&i){const t=a.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",(null==n.selectedBuyer?null:n.selectedBuyer.oid)!==t.oid)}}function Ye(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-button",38),e.NdJ("clickEvent",function(){return e.CHM(t),e.oxw(2).createBuyer()}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("iconName","plus")("disabled",!t.hasPrivilege("BUYER_CREATE"))}}const le=function(){return{standalone:!0}};function Re(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-checkbox",39),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).allowChangeBuyer=o}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("color","primary")("ngModel",t.allowChangeBuyer)("ngModelOptions",e.DdM(6,le)),e.xp6(1),e.Oqu(e.lcZ(2,4,"changeBuyer"))}}function Ve(i,a){if(1&i&&(e.TgZ(0,"mat-option"),e._UZ(1,"ngx-mat-select-search",14),e.ALo(2,"translate"),e.ALo(3,"translate"),e.ALo(4,"async"),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.s9C("placeholderLabel",e.lcZ(2,7,"searchFor")),e.s9C("noEntriesFoundLabel",e.lcZ(3,9,"noResults")),e.Q6J("formControl",t.searchControlOnChange)("hideClearSearchButton",!0)("clearSearchInput",!0)("searching",e.lcZ(4,11,t.isLoadingOnChange)||!1)("disableScrollToActiveOnOptionsChanged",!0)}}function Ge(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.Q6J("value",t.selectedBuyerOnChange),e.xp6(1),e.Oqu(t.selectedBuyerOnChange.name)}}function $e(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function ze(i,a){if(1&i&&(e.ynx(0),e.YNc(1,$e,2,2,"mat-option",15),e.BQk()),2&i){const t=a.$implicit,n=e.oxw(3);e.xp6(1),e.Q6J("ngIf",(null==n.selectedBuyerOnChange?null:n.selectedBuyerOnChange.oid)!==t.oid)}}function Ke(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field"),e.TgZ(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",40),e.NdJ("infiniteScroll",function(){return e.CHM(t),e.oxw(2).bottomReachedHandlerBuyersOnChange()})("selectionChange",function(o){return e.CHM(t),e.oxw(2).selectBuyerOnChange(o)}),e.YNc(5,Ve,5,13,"mat-option",3),e.YNc(6,Ge,2,2,"mat-option",15),e.YNc(7,ze,2,1,"ng-container",16),e.ALo(8,"async"),e.qZA(),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(1),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(3,9,"buyer")," "),e.xp6(2),e.Q6J("compareWith",t.compareFn),e.xp6(1),e.Q6J("ngIf",t.isEdit),e.xp6(1),e.Q6J("ngIf",t.selectedBuyerOnChange),e.xp6(1),e.Q6J("ngForOf",e.lcZ(8,11,t.buyersEntitiesOnChange))}}function Xe(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function et(i,a){if(1&i&&(e.TgZ(0,"mat-option",36),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.displayName)," ")}}function tt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-option",61),e.NdJ("click",function(){const r=e.CHM(t).index,s=e.oxw(2).index;return e.oxw(3).removeWorkOrderItemFromInvoiceItem(s,r)}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=a.$implicit,n=e.oxw(5);e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.value.description+", "+t.value.sumQuantity+" "+e.lcZ(2,2,n.getUOMDisplayValue(t.value.uom)))}}function nt(i,a){if(1&i&&(e.TgZ(0,"mat-form-field"),e.TgZ(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",59),e.YNc(5,tt,3,4,"mat-option",60),e.qZA(),e.qZA()),2&i){const t=e.oxw(),n=t.$implicit,o=t.index,r=e.oxw(3);e.xp6(2),e.Oqu(e.lcZ(3,3,"workOrder")),e.xp6(2),e.Q6J("value",n.value.workOrderItems),e.xp6(1),e.Q6J("ngForOf",r.getWorkOrderItemsFormArr(o).controls)}}function ot(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",43),e.TgZ(1,"div",44),e.TgZ(2,"mat-form-field",45),e.TgZ(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"input",46,47),e.NdJ("keydown.enter",function(){return e.CHM(t),e.MAs(7).closePanel()})("keypress",function(o){const s=e.CHM(t).index;return e.oxw(3).onKeypress(o,"description",s)}),e.qZA(),e.TgZ(8,"mat-autocomplete",null,48),e.YNc(10,Xe,2,2,"mat-option",9),e.ALo(11,"async"),e.qZA(),e.qZA(),e.TgZ(12,"mat-form-field",49),e.TgZ(13,"mat-label"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"mat-select",50),e.NdJ("openedChange",function(o){const s=e.CHM(t).index;return e.oxw(3).openedToggleOnUomSelect(o,s)}),e.YNc(17,et,3,4,"mat-option",9),e.qZA(),e.qZA(),e.TgZ(18,"mat-form-field",49),e.TgZ(19,"mat-label"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"input",51),e.NdJ("keypress",function(o){const s=e.CHM(t).index;return e.oxw(3).onKeypress(o,"quantity",s)})("change",function(){const r=e.CHM(t).index;return e.oxw(3).calculateInvoiceItemAmount(r,"quantity")})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),o.setAllInvoiceAmounts()}),e.qZA(),e.qZA(),e.TgZ(23,"mat-form-field",49),e.TgZ(24,"mat-label"),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.TgZ(27,"input",52),e.NdJ("keypress",function(o){const s=e.CHM(t).index;return e.oxw(3).onKeypress(o,"pricePerUnit",s)})("change",function(){const r=e.CHM(t).index;return e.oxw(3).calculateInvoiceItemAmount(r,"pricePerUnit")})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),o.setAllInvoiceAmounts()}),e.qZA(),e.qZA(),e.TgZ(28,"mat-form-field",49),e.TgZ(29,"mat-label"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"input",53),e.NdJ("keypress",function(o){const s=e.CHM(t).index;return e.oxw(3).onKeypress(o,"netPrice",s)})("change",function(){const r=e.CHM(t).index;return e.oxw(3).calculateInvoiceItemAmount(r,"netPrice")})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),o.setAllInvoiceAmounts()}),e.qZA(),e.qZA(),e.TgZ(33,"mat-form-field",49),e.TgZ(34,"mat-label"),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"input",54),e.NdJ("keypress",function(o){const s=e.CHM(t).index;return e.oxw(3).onKeypress(o,"vatRate",s)})("change",function(){const r=e.CHM(t).index;return e.oxw(3).calculateInvoiceItemAmount(r,"vatRate")})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),o.setAllInvoiceAmounts()}),e.qZA(),e.qZA(),e.TgZ(38,"mat-form-field",49),e.TgZ(39,"mat-label"),e._uU(40),e.ALo(41,"translate"),e.qZA(),e.TgZ(42,"input",55),e.NdJ("keypress",function(o){const s=e.CHM(t).index;return e.oxw(3).onKeypress(o,"vatAmount",s)})("change",function(){const r=e.CHM(t).index;return e.oxw(3).calculateInvoiceItemAmount(r,"vatAmount")})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),o.setAllInvoiceAmounts()}),e.qZA(),e.qZA(),e.TgZ(43,"mat-form-field",49),e.TgZ(44,"mat-label"),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.TgZ(47,"input",56),e.NdJ("keypress",function(o){const s=e.CHM(t).index;return e.oxw(3).onKeypress(o,"grossPrice",s)})("change",function(){const r=e.CHM(t).index;return e.oxw(3).calculateInvoiceItemAmount(r,"grossPrice")})("focusout",function(){e.CHM(t);const o=e.oxw(3);return o.calculateInvoiceAmount(),o.setAllInvoiceAmounts()}),e.qZA(),e.qZA(),e.YNc(48,nt,6,5,"mat-form-field",3),e.TgZ(49,"app-button",57),e.NdJ("clickEvent",function(){const r=e.CHM(t).index;return e.oxw(3).importWorkOrderItems(r)}),e.ALo(50,"translate"),e.qZA(),e.TgZ(51,"app-button",58),e.NdJ("clickEvent",function(){const r=e.CHM(t).index;return e.oxw(3).removeItem(r)}),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=a.$implicit,n=a.index,o=e.MAs(9),r=e.oxw(3);let s;e.xp6(1),e.Q6J("formGroupName",n),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(5,49,"description")," "),e.xp6(2),e.Q6J("matAutocomplete",o)("matTooltip",null==(s=r.getDescription(n))?null:s.value),e.xp6(4),e.Q6J("ngForOf",e.lcZ(11,51,r.getFilteredOptions(n))),e.xp6(3),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(15,53,"uom")," "),e.xp6(3),e.Q6J("ngForOf",r.uomOptions),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(21,55,"quantity")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(26,57,"pricePerUnit")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(31,59,"netPrice")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(36,61,"vatRate")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(41,63,"vatAmount")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(46,65,"grossPrice")," "),e.xp6(3),e.Q6J("ngIf",t.value.workOrderItems.length>0),e.xp6(1),e.Q6J("text",e.lcZ(50,67,"import")),e.xp6(2),e.Q6J("iconName","minus")("isTransparentMode",!0)}}function it(i,a){if(1&i&&(e.TgZ(0,"div",41),e.YNc(1,ot,52,69,"div",42),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.invoiceItemsFormArr.controls)}}function rt(i,a){1&i&&(e.TgZ(0,"mat-form-field"),e.TgZ(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"input",62),e.qZA()),2&i&&(e.xp6(1),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(3,5,"advancePayAmount")," "))}function st(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",7),e.TgZ(1,"div",44),e.TgZ(2,"mat-form-field"),e.TgZ(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"input",66),e.qZA(),e.TgZ(7,"mat-form-field"),e.TgZ(8,"mat-label"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e._UZ(11,"input",67),e.qZA(),e.qZA(),e.TgZ(12,"app-button",58),e.NdJ("clickEvent",function(){const r=e.CHM(t).index;return e.oxw(3).removeNote(r)}),e.qZA(),e.qZA()}if(2&i){const t=a.index;e.xp6(1),e.Q6J("formGroupName",t),e.xp6(3),e.Oqu(e.lcZ(5,5,"field")),e.xp6(5),e.Oqu(e.lcZ(10,7,"value")),e.xp6(3),e.Q6J("iconName","minus")("isTransparentMode",!0)}}function ct(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",63),e.YNc(1,st,13,9,"div",64),e.TgZ(2,"app-button",65),e.NdJ("clickEvent",function(){return e.CHM(t),e.oxw(2).addNote()}),e.ALo(3,"translate"),e.qZA(),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.notesFormArr.controls),e.xp6(1),e.Q6J("text",e.lcZ(3,2,"addNote"))}}function at(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"form",6),e.TgZ(1,"div",7),e.TgZ(2,"mat-form-field"),e.TgZ(3,"mat-label"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"mat-select",8),e.NdJ("valueChange",function(o){return e.CHM(t),e.oxw().invoiceTypeChanged(o)}),e.YNc(7,Be,3,4,"mat-option",9),e.qZA(),e.qZA(),e.YNc(8,Qe,5,7,"mat-form-field",3),e.TgZ(9,"mat-form-field"),e.TgZ(10,"mat-label"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"input",10),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"currency")}),e.qZA(),e.qZA(),e.TgZ(14,"mat-form-field"),e.TgZ(15,"mat-label"),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"input",11),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"number")}),e.qZA(),e.qZA(),e.TgZ(19,"app-button",12),e.NdJ("clickEvent",function(){return e.CHM(t),e.oxw().setInvoiceNumber()}),e.ALo(20,"translate"),e.qZA(),e.qZA(),e.TgZ(21,"div",7),e.TgZ(22,"mat-form-field"),e.TgZ(23,"mat-label"),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"mat-select",13),e.NdJ("valueChange",function(){return e.CHM(t),e.oxw().buyerChanged()})("infiniteScroll",function(){return e.CHM(t),e.oxw().bottomReachedHandlerBuyers()})("selectionChange",function(o){return e.CHM(t),e.oxw().selectBuyer(o)}),e.TgZ(27,"mat-option"),e._UZ(28,"ngx-mat-select-search",14),e.ALo(29,"translate"),e.ALo(30,"translate"),e.ALo(31,"async"),e.qZA(),e.YNc(32,We,2,2,"mat-option",15),e.YNc(33,He,2,1,"ng-container",16),e.ALo(34,"async"),e.qZA(),e.qZA(),e.YNc(35,Ye,1,2,"app-button",17),e.YNc(36,Re,3,7,"mat-checkbox",18),e.YNc(37,Ke,9,13,"mat-form-field",3),e.TgZ(38,"mat-checkbox",19),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw().isInvoiceTaxFree=o})("change",function(){return e.CHM(t),e.oxw().changeIsInvoiceTaxFree()}),e._uU(39),e.ALo(40,"translate"),e.qZA(),e.qZA(),e.TgZ(41,"div",7),e.TgZ(42,"mat-form-field"),e.TgZ(43,"mat-label"),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"input",20),e.NdJ("change",function(){return e.CHM(t),e.oxw().consolidateAllDates()})("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"dateOfCreate")}),e.qZA(),e.qZA(),e.TgZ(47,"mat-form-field"),e.TgZ(48,"mat-label"),e._uU(49),e.ALo(50,"translate"),e.qZA(),e.TgZ(51,"input",21),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"dateOfTurnover")}),e.qZA(),e.qZA(),e.TgZ(52,"mat-form-field"),e.TgZ(53,"mat-label"),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.TgZ(56,"input",22),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"dateOfMaturity")}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(57,"div",7),e.TgZ(58,"mat-form-field"),e.TgZ(59,"mat-label"),e._uU(60),e.ALo(61,"translate"),e.qZA(),e.TgZ(62,"input",23),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"country")}),e.qZA(),e.qZA(),e.TgZ(63,"mat-form-field"),e.TgZ(64,"mat-label"),e._uU(65),e.ALo(66,"translate"),e.qZA(),e.TgZ(67,"input",24),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"placeOfIssue")}),e.qZA(),e.qZA(),e.TgZ(68,"mat-form-field"),e.TgZ(69,"mat-label"),e._uU(70),e.ALo(71,"translate"),e.qZA(),e.TgZ(72,"input",25),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"methodOfPayment")}),e.qZA(),e.qZA(),e.qZA(),e.YNc(73,it,2,1,"div",26),e.TgZ(74,"div",27),e.TgZ(75,"app-button",28),e.NdJ("clickEvent",function(){return e.CHM(t),e.oxw().addNewItem()}),e.ALo(76,"translate"),e.qZA(),e.TgZ(77,"app-button",29),e.NdJ("clickEvent",function(){return e.CHM(t),e.oxw().autoImport()}),e.ALo(78,"translate"),e.qZA(),e.qZA(),e.TgZ(79,"mat-form-field"),e.TgZ(80,"mat-label"),e._uU(81),e.ALo(82,"translate"),e.qZA(),e.TgZ(83,"textarea",30),e.NdJ("keypress",function(o){return e.CHM(t),e.oxw().onKeypress(o,"comment")}),e.qZA(),e.qZA(),e.TgZ(84,"div",7),e.TgZ(85,"mat-form-field"),e.TgZ(86,"mat-label"),e._uU(87),e.ALo(88,"translate"),e.qZA(),e._UZ(89,"input",31),e.qZA(),e.TgZ(90,"mat-form-field"),e.TgZ(91,"mat-label"),e._uU(92),e.ALo(93,"translate"),e.qZA(),e._UZ(94,"input",32),e.qZA(),e.TgZ(95,"mat-form-field"),e.TgZ(96,"mat-label"),e._uU(97),e.ALo(98,"translate"),e.qZA(),e._UZ(99,"input",33),e.qZA(),e.TgZ(100,"mat-form-field"),e.TgZ(101,"mat-label"),e._uU(102),e.ALo(103,"translate"),e.qZA(),e._UZ(104,"input",34),e.qZA(),e.YNc(105,rt,5,7,"mat-form-field",3),e.qZA(),e.YNc(106,ct,4,4,"div",35),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("formGroup",t.formGroup),e.xp6(3),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(5,114,"type")," "),e.xp6(2),e.Q6J("disabled",t.isEdit),e.xp6(1),e.Q6J("ngForOf",t.typesOptions),e.xp6(1),e.Q6J("ngIf",t.numberOfCashBillControl),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(12,116,"currency")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(17,118,"number")," "),e.xp6(3),e.Q6J("isTransparentMode",!0)("text",e.lcZ(20,120,"createNumber")),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(25,122,"buyer")," "),e.xp6(2),e.Q6J("disabled",t.isEdit)("compareWith",t.compareFn)("matTooltip",(null==t.selectedBuyer?null:t.selectedBuyer.name)||""),e.xp6(2),e.s9C("placeholderLabel",e.lcZ(29,124,"searchFor")),e.s9C("noEntriesFoundLabel",e.lcZ(30,126,"noResults")),e.Q6J("formControl",t.searchControl)("hideClearSearchButton",!0)("clearSearchInput",!0)("searching",e.lcZ(31,128,t.isLoading)||!1)("disableScrollToActiveOnOptionsChanged",!0),e.xp6(4),e.Q6J("ngIf",t.selectedBuyer),e.xp6(1),e.Q6J("ngForOf",e.lcZ(34,130,t.buyersEntities)),e.xp6(2),e.Q6J("ngIf",!t.isEdit),e.xp6(1),e.Q6J("ngIf",t.isEdit),e.xp6(1),e.Q6J("ngIf",t.isEdit&&t.allowChangeBuyer),e.xp6(1),e.Q6J("color","primary")("ngModel",t.isInvoiceTaxFree)("ngModelOptions",e.DdM(160,le)),e.xp6(1),e.Oqu(e.lcZ(40,132,"invoiceTaxFree")),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(45,134,"dateOfCreate")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(50,136,"dateOfTurnover")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(55,138,"dateOfMaturity")," "),e.xp6(5),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(61,140,"country")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(66,142,"placeOfIssue")," "),e.xp6(4),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(71,144,"methodOfPayment")," "),e.xp6(3),e.Q6J("ngIf",t.isBuyerSelected),e.xp6(2),e.Q6J("iconName","plus")("text",e.lcZ(76,146,"addNewItem"))("disabled",!t.isBuyerSelected),e.xp6(2),e.Q6J("iconName","plus")("text",e.lcZ(78,148,"autoImport"))("isTransparentMode",!0)("disabled",!t.isBuyerSelected),e.xp6(3),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(82,150,"comment")," "),e.xp6(5),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(88,152,"netAmount")," "),e.xp6(2),e.Q6J("readonly",!0),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(93,154,"vatRate")," "),e.xp6(2),e.Q6J("readonly",!0),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(98,156,"vatAmount")," "),e.xp6(2),e.Q6J("readonly",!0),e.xp6(2),e.ekj("mark-required",!0)("mark-opt-required",!0),e.xp6(1),e.hij(" ",e.lcZ(103,158,"grossAmount")," "),e.xp6(2),e.Q6J("readonly",!0),e.xp6(1),e.Q6J("ngIf",t.advanceInvoice||t.invoice&&t.invoice.advancePayAmount>0),e.xp6(1),e.Q6J("ngIf",t.notesFormArr.controls)}}function lt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",68),e.TgZ(1,"app-button",69),e.NdJ("clickEvent",function(){return e.CHM(t),e.oxw().cancel()}),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"app-button",70),e.NdJ("clickEvent",function(){return e.CHM(t),e.oxw().handleSubmitButton()}),e.ALo(4,"translate"),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("text",e.lcZ(2,3,"cancel")),e.xp6(2),e.Q6J("text",e.lcZ(4,5,"save"))("disabled",!t.formGroup.dirty||t.formGroup.invalid)}}const ut=[{path:"",component:(()=>{class i{constructor(t,n,o,r,s,l,m,u,p,h,_,g,v,f,I,b){this.router=t,this.route=n,this.globalService=o,this.webService=r,this.workOrderWebService=s,this.buyerWebService=l,this.buyerCreateEditPopupService=m,this.settingsStoreService=u,this.translateService=p,this.listEntities=h,this.listEntitiesOnChange=_,this.el=g,this.workOrderSelectionComponentService=v,this.workOrderItemSelectionComponentService=f,this.sweetAlertService=I,this.authStoreService=b,this.subs=new M.L,this.invoiceOID=null,this.isEdit=!1,this.typesOptions=S.TY,this.uomOptions=S.pM,this.invoiceItemsOptions=[],this.filteredOptions=[],this.buyersEntities=this.listEntities.entities,this.isLoading=this.listEntities.isLoading,this.searchControl=new c.NI,this.compareFn=x.nt,this.isInvoiceTaxFree=!1,this.allowChangeBuyer=!1,this.buyersEntitiesOnChange=this.listEntities.entities,this.isLoadingOnChange=this.listEntities.isLoading,this.searchControlOnChange=new c.NI,this.debounceTime=500,this.getUOMDisplayValue=x.HL}get numberOfCashBillControl(){return this.formGroup.get("numberOfCashBill")}getDescription(t){return this.invoiceItemsFormArr.controls[t].get("description")}getUOM(t){return this.invoiceItemsFormArr.controls[t].get("uom")}getQuantity(t){return this.invoiceItemsFormArr.controls[t].get("quantity")}getPricePerUnit(t){return this.invoiceItemsFormArr.controls[t].get("pricePerUnit")}getNetPrice(t){return this.invoiceItemsFormArr.controls[t].get("netPrice")}getVatRate(t){return this.invoiceItemsFormArr.controls[t].get("vatRate")}getVatAmount(t){return this.invoiceItemsFormArr.controls[t].get("vatAmount")}getGrossPrice(t){return this.invoiceItemsFormArr.controls[t].get("grossPrice")}getWorkOrderItemsFormArr(t){return this.invoiceItemsFormArr.controls[t].get("workOrderItems")}get invoiceItemsFormArr(){return this.formGroup.get("invoiceItems")}get notesFormArr(){return this.formGroup.get("notes")}ngOnInit(){this.invoiceOID=this.route.snapshot.paramMap.get("invoiceOID");const t=this.route.snapshot.queryParamMap.get("workOrderOID"),n=this.route.snapshot.queryParamMap.get("preInvoiceOID"),o=this.route.snapshot.queryParamMap.get("advanceInvoiceOID");this.subs.sink=this.webService.getAllInvoiceItemDescriptions().subscribe(r=>{this.invoiceItemsOptions=r}),this.subs.sink=this.listEntities.setWebService(this.buyerWebService).requestFirstPage(),this.isEdit&&(this.subs.sink=this.listEntitiesOnChange.setWebService(this.buyerWebService).requestFirstPage()),this.subs.sink=this.settingsStoreService.dataLoaded$.subscribe(r=>{r&&(this.settings=this.settingsStoreService.getSettings(),this.isEdit=!!this.invoiceOID,this.isEdit&&this.invoiceOID?this.subs.sink=this.webService.getEntityByOid(this.invoiceOID).subscribe(s=>{this.invoice=s,this.invoice.preInvoiceOid&&(this.subs.sink=this.webService.getEntityByOid(this.invoice.preInvoiceOid).subscribe(l=>{this.preInvoice=l})),this.invoice.advanceInvoiceOid&&(this.subs.sink=this.webService.getEntityByOid(this.invoice.advanceInvoiceOid).subscribe(l=>{this.preInvoice=l})),this.initializeCreate()}):(this.initializeCreate(),t?this.workOrderWebService.getEntityByOid(t).subscribe(s=>{var l;null===(l=this.formGroup.get("buyer"))||void 0===l||l.setValue(s.buyer),this.selectedBuyer=s.buyer,this.addWorkOrderToNewInvoiceItem([s])}):n?this.importInvoiceFrom("preInvoice",n):o&&this.importInvoiceFrom("advanceInvoice",o)))}),this.inputSearchControlSubscription=this.searchControl.valueChanges.pipe((0,z.b)(this.debounceTime)).subscribe(()=>{this.searchHandler(this.searchControl.value)}),this.inputSearchControlOnChangeSubscription=this.searchControlOnChange.valueChanges.pipe((0,z.b)(this.debounceTime)).subscribe(()=>{this.searchHandlerOnChange(this.searchControlOnChange.value)})}hasPrivilege(t){return this.authStoreService.isAllowed(t)}initializeCreate(){var t,n,o,r,s,l,m,u,p,h,_,g,v,f,I,b,k,y,U,B,Q,W,D;this.isEdit&&(this.selectedBuyer=this.invoice.buyer),this.formGroup=new c.cw({type:new c.NI((null===(t=this.invoice)||void 0===t?void 0:t.type)||this.typesOptions[0].value,[c.kI.required]),number:new c.NI((null===(n=this.invoice)||void 0===n?void 0:n.number)||0,[c.kI.required]),dateOfCreate:new c.NI((null===(o=this.invoice)||void 0===o?void 0:o.dateOfCreate)||(new Date).toISOString().substring(0,10),[c.kI.required]),dateOfTurnover:new c.NI((null===(r=this.invoice)||void 0===r?void 0:r.dateOfTurnover)||(new Date).toISOString().substring(0,10),[c.kI.required]),dateOfMaturity:new c.NI((null===(s=this.invoice)||void 0===s?void 0:s.dateOfMaturity)||(new Date).toISOString().substring(0,10),[c.kI.required]),placeOfIssue:new c.NI((null===(l=this.invoice)||void 0===l?void 0:l.placeOfIssue)||(null===(m=this.settings)||void 0===m?void 0:m.invoicePlaceOfIssue)||"",[c.kI.required]),methodOfPayment:new c.NI((null===(u=this.invoice)||void 0===u?void 0:u.methodOfPayment)||(null===(p=this.settings)||void 0===p?void 0:p.invoiceMethodOfPayment),[c.kI.required]),comment:new c.NI((null===(h=this.invoice)||void 0===h?void 0:h.comment)||"",[]),netAmount:new c.NI((null===(_=this.invoice)||void 0===_?void 0:_.netAmount)||0,[c.kI.required,c.kI.min(.01)]),vatRate:new c.NI((null===(g=this.invoice)||void 0===g?void 0:g.vatRate)||0,[c.kI.required]),vatAmount:new c.NI((null===(v=this.invoice)||void 0===v?void 0:v.vatAmount)||0,[c.kI.required]),grossAmount:new c.NI((null===(f=this.invoice)||void 0===f?void 0:f.grossAmount)||0,[c.kI.required,c.kI.min(.01)]),currency:new c.NI((null===(I=this.invoice)||void 0===I?void 0:I.currency)||(null===(b=this.settings)||void 0===b?void 0:b.invoiceCurrency)||"",[c.kI.required]),country:new c.NI((null===(k=this.invoice)||void 0===k?void 0:k.country)||(null===(y=this.settings)||void 0===y?void 0:y.invoiceCountry)||"",[c.kI.required]),buyer:new c.NI(this.selectedBuyer||"",[c.kI.required]),invoiceItems:new c.Oe([]),notes:new c.Oe([]),preInvoiceOid:new c.NI(null===(U=this.preInvoice)||void 0===U?void 0:U.oid),advanceInvoiceOid:new c.NI(null===(B=this.advanceInvoice)||void 0===B?void 0:B.oid),advancePayAmount:new c.NI((null===(Q=this.invoice)||void 0===Q?void 0:Q.advancePayAmount)||(null===(W=this.advanceInvoice)||void 0===W?void 0:W.grossAmount)||0)}),"CASH"===(null===(D=this.formGroup.get("type"))||void 0===D?void 0:D.value)&&this.formGroup.addControl("numberOfCashBill",new c.NI(this.invoice.numberOfCashBill||"",[c.kI.required])),this.isEdit?(this.invoice.invoiceItems.forEach(H=>this.addNewItem(H)),this.invoice.notes.forEach(H=>this.addNote(H))):this.setInvoiceNumber()}selectBuyer(t){t&&t.value&&(this.selectedBuyer=t.value)}selectBuyerOnChange(t){if(t&&t.value){this.selectedBuyerOnChange=t.value,this.subs.sink.$markWorkOrder=this.sweetAlertService.getDataBackFromSweetAlert().subscribe(o=>{var r,s;o&&o.confirmed&&this.invoiceOID&&(null===(r=this.selectedBuyerOnChange)||void 0===r?void 0:r.oid)&&(this.subs.sink=this.webService.changeBuyer(this.invoiceOID,null===(s=this.selectedBuyerOnChange)||void 0===s?void 0:s.oid).subscribe(l=>{l&&(this.globalService.showBasicAlert(N.I.success,this.translateService.instant("successfully"),this.translateService.instant("invoiceIsSuccessfullyUpdated")),window.location.reload())}))});const n={mode:"warning",icon:"alert-triangle",type:{name:Pe.N.submit,buttons:{submit:this.translateService.instant("change"),cancel:this.translateService.instant("cancel")}},title:this.translateService.instant("changeBuyer"),message:this.translateService.instant("areYouSureYouWantToAllowChangeOfBuyerWithAllConsequences")};this.sweetAlertService.openMeSweetAlert(n)}}isBuyerSelected(){var t;return!!(null===(t=this.formGroup.get("buyer"))||void 0===t?void 0:t.value)}addNewItem(t){var n;this.invoiceItemsFormArr.push(new c.cw({oid:new c.NI((null==t?void 0:t.oid)||""),description:new c.NI((null==t?void 0:t.description)||"",[c.kI.required]),uom:new c.NI((null==t?void 0:t.uom)||this.uomOptions[0].value,[c.kI.required]),quantity:new c.NI((null==t?void 0:t.quantity)||0,[c.kI.required,c.kI.min(0)]),pricePerUnit:new c.NI((null==t?void 0:t.pricePerUnit)||0,[c.kI.required,c.kI.min(0)]),netPrice:new c.NI((null==t?void 0:t.netPrice)||0,[c.kI.required,c.kI.min(0)]),vatRate:new c.NI(t?t.vatRate:(this.isInvoiceTaxFree?0:null===(n=this.settings)||void 0===n?void 0:n.invoiceVatRate)||0,[c.kI.required,c.kI.min(0)]),vatAmount:new c.NI((null==t?void 0:t.vatAmount)||0,[c.kI.required,c.kI.min(0)]),grossPrice:new c.NI((null==t?void 0:t.grossPrice)||0,[c.kI.required,c.kI.min(0)]),workOrderItems:new c.Oe([])})),setTimeout(()=>{var o;const r=null===(o=this.getDescription(this.invoiceItemsFormArr.length-1))||void 0===o?void 0:o.valueChanges.pipe((0,_e.O)(""),(0,ve.U)(s=>this._filter(s||"")));this.filteredOptions.push(r)}),null==t||t.workOrderItems.forEach(o=>{this.addNewWorkOrderItemToInvoiceItem(this.invoiceItemsFormArr.length-1,[o])}),this.calculateInvoiceAmount()}_filter(t){const n=t.toLowerCase();return this.invoiceItemsOptions.filter(o=>o.toLowerCase().includes(n))}addWorkOrderToNewInvoiceItem(t){const n=[],o=this.getAllImportedWorkOrderItemOIDS();t.forEach(r=>{r.workOrderItems.forEach(s=>{var l;if(!o.includes(s.oid)){let m={oid:"",description:s.description,uom:s.uom,quantity:s.sumQuantity,pricePerUnit:0,netPrice:0,vatRate:(null===(l=this.settings)||void 0===l?void 0:l.invoiceVatRate)||20,vatAmount:0,grossPrice:0,workOrderItems:[s]};const u=n.filter(p=>p.description===m.description&&p.uom===m.uom)[0];u?(u.quantity=u.quantity+m.quantity,u.workOrderItems.push(s)):n.push(m)}}),this.addWorkOrderToComment(r)}),n.forEach(r=>{this.addNewItem(r)})}addWorkOrderToComment(t){const n=this.formGroup.get("comment");(null==n?void 0:n.value.length)&&!(null==n?void 0:n.value.includes((0,x.Nw)(t)))?n.setValue(n.value+", "+(0,x.Nw)(t)):null==n||n.setValue(this.translateService.instant("attachmentWorkOrderNumber")+" "+(0,x.Nw)(t))}addNewWorkOrderItemToInvoiceItem(t,n){n.forEach(o=>{this.getWorkOrderItemsFormArr(t).push(new c.cw({oid:new c.NI(o.oid),description:new c.NI(o.description),uom:new c.NI(o.uom),dimension1:new c.NI(o.dimension1),dimension2:new c.NI(o.dimension2),dimension3:new c.NI(o.dimension3),quantity:new c.NI(o.quantity),sumQuantity:new c.NI(o.sumQuantity),note:new c.NI(o.note)}))})}importWorkOrderItems(t){var n;this.workOrderItemSelectionComponentService.openDialog((null===(n=this.selectedBuyer)||void 0===n?void 0:n.oid)||"",this.getAllImportedWorkOrderItemOIDS()).subscribe(o=>{if(o){const r=[];o.forEach(s=>{s.workOrderItems.forEach(l=>{var m;let u={oid:"",description:l.description,uom:l.uom,quantity:l.sumQuantity,pricePerUnit:0,netPrice:0,vatRate:(null===(m=this.settings)||void 0===m?void 0:m.invoiceVatRate)||20,vatAmount:0,grossPrice:0,workOrderItems:[l]};const p=r.filter(h=>h.uom===u.uom)[0];p?(p.description=p.description.includes(l.description)?l.description:p.description+", "+l.description,p.quantity=p.quantity+u.quantity,p.workOrderItems.push(l)):r.push(u)})}),r.forEach((s,l)=>{var m,u,p,h,_,g,v,f;const I=null===(m=this.getDescription(t))||void 0===m?void 0:m.value;!I&&0===(null===(u=this.getQuantity(t))||void 0===u?void 0:u.value)||(null===(p=this.getDescription(t))||void 0===p?void 0:p.value.includes(s.description))&&(null===(h=this.getUOM(t))||void 0===h?void 0:h.value)===s.uom?(I.includes(s.description)||null===(_=this.getDescription(t))||void 0===_||_.setValue(I.length?", "+s.description:s.description),null===(g=this.getUOM(t))||void 0===g||g.setValue(s.uom),null===(v=this.getQuantity(t))||void 0===v||v.setValue((null===(f=this.getQuantity(t))||void 0===f?void 0:f.value)+s.quantity),this.addNewWorkOrderItemToInvoiceItem(t,s.workOrderItems)):this.addNewItem(s)}),o.forEach(s=>{this.addWorkOrderToComment(s)})}})}removeWorkOrderItemFromInvoiceItem(t,n){this.getWorkOrderItemsFormArr(t).removeAt(n),this.formGroup.markAsDirty()}buyerChanged(){setTimeout(()=>{var t;this.isBuyerSelected=null===(t=this.formGroup.get("buyer"))||void 0===t?void 0:t.value;for(let n=this.invoiceItemsFormArr.controls.length-1;n>=0;n--)this.invoiceItemsFormArr.controls[n].value.workOrderItems&&this.invoiceItemsFormArr.controls[n].value.workOrderItems.length&&this.invoiceItemsFormArr.removeAt(n);this.setFocusOn("dateOfCreate")})}removeItem(t){this.invoiceItemsFormArr.removeAt(t),this.calculateInvoiceAmount(),this.formGroup.markAsDirty()}cancel(){this.router.navigate(["/"])}handleSubmitButton(){this.setAllInvoiceAmounts(),this.isEdit&&this.invoiceOID?this.webService.updateEntity(this.invoiceOID,this.formGroup.value).subscribe(t=>{t&&this.globalService.showBasicAlert(N.I.success,this.translateService.instant("successfully"),this.translateService.instant("invoiceIsSuccessfullyUpdated"))}):this.webService.createEntity(this.formGroup.value).subscribe(t=>{t&&(this.globalService.showBasicAlert(N.I.success,this.translateService.instant("successfully"),this.translateService.instant("newInvoiceIsSuccessfullyCreated")),window.open("#/print/invoice-view/"+t.oid),this.router.navigate(["invoices","edit",t.oid]))})}invoiceTypeChanged(t){setTimeout(()=>{var n,o,r,s,l,m,u,p,h,_,g,v,f,I,b,k;if(null===(n=this.formGroup.get("comment"))||void 0===n||n.setValue(""),"FOREIGN"!==t&&this.notesFormArr.controls.length)for(let y=this.notesFormArr.controls.length-1;y>=0;y--)this.removeNote(y);switch(t){case"CASH":this.formGroup.addControl("numberOfCashBill",new c.NI("",[c.kI.required])),null===(o=this.formGroup.get("currency"))||void 0===o||o.setValue(null===(r=this.settings)||void 0===r?void 0:r.invoiceCurrency),setTimeout(()=>{this.setFocusOn("numberOfCashBill")}),null===(s=this.formGroup.get("methodOfPayment"))||void 0===s||s.setValue(null===(l=this.settings)||void 0===l?void 0:l.invoiceMethodOfPaymentForCashBill);break;case"FOREIGN":null===(m=this.formGroup.get("currency"))||void 0===m||m.setValue("EUR"),null===(u=this.formGroup.get("comment"))||void 0===u||u.setValue(null===(p=this.settings)||void 0===p?void 0:p.invoiceForeignNote),null===(_=null===(h=this.settings)||void 0===h?void 0:h.invoiceForeignNotes)||void 0===_||_.forEach(y=>{this.addNote({oid:"",name:y.key,description:y.value})}),null===(g=this.formGroup.get("methodOfPayment"))||void 0===g||g.setValue(null===(v=this.settings)||void 0===v?void 0:v.invoiceMethodOfPayment);break;default:this.formGroup.removeControl("numberOfCashBill"),null===(f=this.formGroup.get("currency"))||void 0===f||f.setValue(null===(I=this.settings)||void 0===I?void 0:I.invoiceCurrency),this.setFocusOn("currency"),null===(b=this.formGroup.get("methodOfPayment"))||void 0===b||b.setValue(null===(k=this.settings)||void 0===k?void 0:k.invoiceMethodOfPayment)}this.isEdit||this.setInvoiceNumber()})}setInvoiceNumber(){var t,n;this.webService.getNextInvoiceNumber(null===(t=this.formGroup.get("type"))||void 0===t?void 0:t.value,null===(n=this.formGroup.get("dateOfCreate"))||void 0===n?void 0:n.value).subscribe(o=>{var r,s;null===(r=this.formGroup.get("number"))||void 0===r||r.setValue(o+"/"+new Date(null===(s=this.formGroup.get("dateOfCreate"))||void 0===s?void 0:s.value).getFullYear().toString())})}createBuyer(){this.buyerCreateEditPopupService.openDialog().subscribe(t=>{t&&this.listEntities.requestFirstPage()})}changeIsInvoiceTaxFree(){var t,n,o,r;const s=this.formGroup.get("comment"),l=(null==s?void 0:s.value)||"";this.isInvoiceTaxFree?(this.invoiceItemsFormArr.controls.forEach((m,u)=>{var p;null===(p=m.get("vatRate"))||void 0===p||p.setValue(0),this.calculateInvoiceItemAmount(u,"vatRate")}),(null===(t=this.settings)||void 0===t?void 0:t.invoiceTaxFreeText)&&l.includes(null===(n=this.settings)||void 0===n?void 0:n.invoiceTaxFreeText)||null==s||s.setValue(l+(l.length>0?", ":"")+(null===(o=this.settings)||void 0===o?void 0:o.invoiceTaxFreeText))):(this.invoiceItemsFormArr.controls.forEach((m,u)=>{var p,h;null===(p=m.get("vatRate"))||void 0===p||p.setValue(null===(h=this.settings)||void 0===h?void 0:h.invoiceVatRate),this.calculateInvoiceItemAmount(u,"vatRate")}),(null===(r=this.settings)||void 0===r?void 0:r.invoiceTaxFreeText)&&l.includes(this.settings.invoiceTaxFreeText)&&(null==s||s.setValue(l.replace(this.settings.invoiceTaxFreeText,""))))}calculateInvoiceItemAmount(t,n){let o=this.invoiceItemsFormArr.controls[t].get("quantity"),r=1*(null==o?void 0:o.value),s=this.invoiceItemsFormArr.controls[t].get("pricePerUnit"),l=1*(null==s?void 0:s.value),m=this.invoiceItemsFormArr.controls[t].get("netPrice"),u=1*(null==m?void 0:m.value),p=this.invoiceItemsFormArr.controls[t].get("vatRate"),h=1*(null==p?void 0:p.value),_=this.invoiceItemsFormArr.controls[t].get("vatAmount"),g=1*(null==_?void 0:_.value),v=this.invoiceItemsFormArr.controls[t].get("grossPrice"),f=1*(null==v?void 0:v.value);switch(n){case"quantity":case"pricePerUnit":u=r*l,null==m||m.setValue(u),g=u*h/100,null==_||_.setValue(g),null==v||v.setValue(u+g);break;case"netPrice":r<=0&&(r=1,null==o||o.setValue(r)),l=u/r,null==s||s.setValue(l),g=u*h/100,null==_||_.setValue(g),null==v||v.setValue(u+g);break;case"vatRate":g=u*h/100,null==_||_.setValue(g),null==v||v.setValue(u+g);break;case"vatAmount":u=100*g/h,null==m||m.setValue(u),r<=0&&(r=1,null==o||o.setValue(r)),l=u/r,null==s||s.setValue(l),null==v||v.setValue(u+g);break;case"grossPrice":g=f*h/(100+h),null==_||_.setValue(g),u=f-g,null==m||m.setValue(u),r<=0&&(r=1,null==o||o.setValue(r)),l=u/r,null==s||s.setValue(l)}this.calculateInvoiceAmount()}calculateInvoiceAmount(){setTimeout(()=>{var t,n,o,r;let s=0,l=0,m=0,u=0;this.invoiceItemsFormArr.value.forEach(p=>{s+=p.netPrice,l+=p.vatRate,m+=p.vatAmount,u+=p.grossPrice}),null===(t=this.formGroup.get("netAmount"))||void 0===t||t.setValue((0,x.wz)(s)),null===(n=this.formGroup.get("vatRate"))||void 0===n||n.setValue((0,x.wz)(l/this.invoiceItemsFormArr.length)),null===(o=this.formGroup.get("vatAmount"))||void 0===o||o.setValue((0,x.wz)(m)),null===(r=this.formGroup.get("grossAmount"))||void 0===r||r.setValue((0,x.wz)(u))})}setAllInvoiceAmounts(){this.invoiceItemsFormArr.controls.forEach(t=>{var n,o,r,s,l,m;const u=1*(null===(n=t.get("grossPrice"))||void 0===n?void 0:n.value),p=1*(null===(o=t.get("vatAmount"))||void 0===o?void 0:o.value),h=1*(null===(r=t.get("vatRate"))||void 0===r?void 0:r.value);null===(s=t.get("grossPrice"))||void 0===s||s.setValue((0,x.wz)(u)),null===(l=t.get("vatAmount"))||void 0===l||l.setValue((0,x.wz)(u*h/(100+h))),null===(m=t.get("netPrice"))||void 0===m||m.setValue((0,x.wz)(u-p))}),this.calculateInvoiceAmount()}autoImport(){var t;this.workOrderSelectionComponentService.openDialog((null===(t=this.selectedBuyer)||void 0===t?void 0:t.oid)||"",[]).subscribe(o=>{o&&this.addWorkOrderToNewInvoiceItem(o)})}getAllImportedWorkOrderItemOIDS(){const t=[];return this.invoiceItemsFormArr.controls.forEach((n,o)=>{this.getWorkOrderItemsFormArr(o).controls.forEach(r=>{t.push(r.value.oid)})}),t}searchHandler(t){let n=new $.h;n.criteriaQuick=t,this.listEntities.setFilter(n)}searchHandlerOnChange(t){let n=new $.h;n.criteriaQuick=t,this.listEntitiesOnChange.setFilter(n)}importInvoiceFrom(t,n){this.webService.getEntityByOid(n).subscribe(o=>{var r,s;"advanceInvoice"===t?this.advanceInvoice=o:this.preInvoice=o,this.selectedBuyer=o.buyer,this.initializeCreate(),null===(r=this.formGroup.get("comment"))||void 0===r||r.setValue((null===(s=this.formGroup.get("comment"))||void 0===s?void 0:s.value)+this.translateService.instant("advanceInvoice"===t?"invoiceCreatedOnAdvanceInvoice":"invoiceCreatedOnPreInvoice",{invoiceNumber:o.number,invoiceDate:new Date(o.dateOfCreate).getDay()+"/"+new Date(o.dateOfCreate).getMonth()+"/"+new Date(o.dateOfCreate).getFullYear()})),o.invoiceItems.forEach((l,m)=>{l.oid="",l.workOrderItems=[],this.addNewItem(l)}),this.formGroup.markAsDirty()})}bottomReachedHandlerBuyers(){this.listEntities.requestNextPage()}bottomReachedHandlerBuyersOnChange(){this.listEntitiesOnChange.requestNextPage()}consolidateAllDates(){var t,n,o,r;null===(t=this.formGroup.get("dateOfTurnover"))||void 0===t||t.setValue(null===(n=this.formGroup.get("dateOfCreate"))||void 0===n?void 0:n.value),null===(o=this.formGroup.get("dateOfMaturity"))||void 0===o||o.setValue(null===(r=this.formGroup.get("dateOfCreate"))||void 0===r?void 0:r.value)}onKeypress(t,n,o=-1){if("Enter"===t.key)switch(t.preventDefault(),n){case"numberOfCashBill":this.setFocusOn("currency");break;case"currency":this.setFocusOn("number");break;case"number":this.setFocusOn("buyer");break;case"dateOfCreate":this.setFocusOn("dateOfTurnover");break;case"dateOfTurnover":this.setFocusOn("dateOfMaturity");break;case"dateOfMaturity":this.setFocusOn("country");break;case"country":this.setFocusOn("placeOfIssue");break;case"placeOfIssue":this.setFocusOn("methodOfPayment");break;case"methodOfPayment":this.setFocusOn("description",0,!0);break;case"description":this.setFocusOn("uom",o);break;case"uom":this.setFocusOn("quantity",o,!0);break;case"quantity":this.setFocusOn("pricePerUnit",o,!0);break;case"pricePerUnit":this.setFocusOn("netPrice",o,!0);break;case"netPrice":this.setFocusOn("vatRate",o,!0);break;case"vatRate":this.setFocusOn("vatAmount",o,!0);break;case"vatAmount":this.setFocusOn("grossPrice",o,!0);break;case"grossPrice":this.invoiceItemsFormArr.length===o+1&&this.addNewItem(),setTimeout(()=>{this.setFocusOn("description",o+1)})}}setFocusOn(t,n=0,o=!1){const r=this.el.nativeElement.querySelectorAll('[formcontrolname="'+t+'"]')[n<0?0:n];null==r||r.focus(),o&&r.select()}openedToggleOnUomSelect(t,n){var o,r;!t&&(null===(o=this.getUOM(n))||void 0===o?void 0:o.value)&&this.uomChanged(null===(r=this.getUOM(n))||void 0===r?void 0:r.value,n)}uomChanged(t,n){setTimeout(()=>{this.setFocusOn("quantity",n,!0)})}getFilteredOptions(t){return this.filteredOptions[t]}addNote(t){this.notesFormArr.push(new c.cw({oid:new c.NI((null==t?void 0:t.oid)||""),name:new c.NI((null==t?void 0:t.name)||"",[c.kI.required]),description:new c.NI((null==t?void 0:t.description)||"",[c.kI.required])}))}removeNote(t){this.notesFormArr.removeAt(t)}ngOnDestroy(){this.inputSearchControlSubscription.unsubscribe(),this.inputSearchControlOnChangeSubscription.unsubscribe(),this.subs.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P.F0),e.Y36(P.gz),e.Y36(qe.U),e.Y36(G.b),e.Y36(T.o),e.Y36(V.e),e.Y36(R.X),e.Y36(Ne.G),e.Y36(A.sK),e.Y36(Z.y),e.Y36(Z.y),e.Y36(e.SBq),e.Y36(oe),e.Y36(ie),e.Y36(Se.T),e.Y36(Fe.g))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-invoice-create-edit"]],inputs:{debounceTime:"debounceTime"},features:[e._Bn([G.b,R.X,V.e,pe.u,Z.y,T.o,oe,ie])],decls:10,vars:7,consts:[[1,"wrapper"],[1,"container"],[1,"title"],[4,"ngIf"],["class","form",3,"formGroup",4,"ngIf"],["class","button-section",4,"ngIf"],[1,"form",3,"formGroup"],[1,"row"],["formControlName","type",3,"disabled","valueChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","matInput","","formControlName","currency",3,"keypress"],["type","text","matInput","","formControlName","number",3,"keypress"],[1,"bottom-padding",3,"isTransparentMode","text","clickEvent"],["formControlName","buyer","msInfiniteScroll","",3,"disabled","compareWith","matTooltip","valueChange","infiniteScroll","selectionChange"],[3,"formControl","placeholderLabel","noEntriesFoundLabel","hideClearSearchButton","clearSearchInput","searching","disableScrollToActiveOnOptionsChanged"],[3,"value",4,"ngIf"],[4,"ngFor","ngForOf"],["class","create-buyer-button",3,"iconName","disabled","clickEvent",4,"ngIf"],["class","create-buyer-button",3,"color","ngModel","ngModelOptions","ngModelChange",4,"ngIf"],[1,"create-buyer-button",3,"color","ngModel","ngModelOptions","ngModelChange","change"],["type","date","matInput","","formControlName","dateOfCreate",3,"change","keypress"],["type","date","matInput","","formControlName","dateOfTurnover",3,"keypress"],["type","date","matInput","","formControlName","dateOfMaturity",3,"keypress"],["type","text","matInput","","formControlName","country",3,"keypress"],["type","text","matInput","","formControlName","placeOfIssue",3,"keypress"],["type","text","matInput","","formControlName","methodOfPayment",3,"keypress"],["formArrayName","invoiceItems","class","invoice-items",4,"ngIf"],[1,"buttons"],[1,"big-button",3,"iconName","text","disabled","clickEvent"],[1,"big-button",3,"iconName","text","isTransparentMode","disabled","clickEvent"],["matInput","","formControlName","comment","rows","3",3,"keypress"],["type","text","appDecimal","","matInput","","formControlName","netAmount",3,"readonly"],["type","text","appDecimal","","matInput","","formControlName","vatRate",3,"readonly"],["type","text","appDecimal","","matInput","","formControlName","vatAmount",3,"readonly"],["type","text","appDecimal","","matInput","","formControlName","grossAmount",3,"readonly"],["class","notes","formArrayName","notes",4,"ngIf"],[3,"value"],["type","text","matInput","","formControlName","numberOfCashBill",3,"keypress"],[1,"create-buyer-button",3,"iconName","disabled","clickEvent"],[1,"create-buyer-button",3,"color","ngModel","ngModelOptions","ngModelChange"],["msInfiniteScroll","",3,"compareWith","infiniteScroll","selectionChange"],["formArrayName","invoiceItems",1,"invoice-items"],["class","invoice-item",4,"ngFor","ngForOf"],[1,"invoice-item"],[1,"form-group",3,"formGroupName"],[1,"full-width"],["type","text","matInput","","formControlName","description",3,"matAutocomplete","matTooltip","keydown.enter","keypress"],["trigger","matAutocompleteTrigger"],["auto","matAutocomplete"],[1,"number-field"],["formControlName","uom",1,"color-black",3,"openedChange"],["type","text","appDecimal","","matInput","","formControlName","quantity",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","pricePerUnit",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","netPrice",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","vatRate",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","vatAmount",3,"keypress","change","focusout"],["type","text","appDecimal","","matInput","","formControlName","grossPrice",3,"keypress","change","focusout"],[1,"additional-button",3,"text","clickEvent"],[1,"additional-button",3,"iconName","isTransparentMode","clickEvent"],["formArrayName","workOrderItems","multiple","",3,"value"],[3,"value","click",4,"ngFor","ngForOf"],[3,"value","click"],["type","text","appDecimal","","matInput","","formControlName","advancePayAmount"],["formArrayName","notes",1,"notes"],["class","row",4,"ngFor","ngForOf"],[3,"text","clickEvent"],["type","text","matInput","","formControlName","name"],["type","text","matInput","","formControlName","description"],[1,"button-section"],["color","secondary",1,"cancel",3,"text","clickEvent"],[1,"update",3,"text","disabled","clickEvent"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"h3"),e._uU(4),e.ALo(5,"translate"),e.YNc(6,je,3,4,"span",3),e.YNc(7,Ue,3,4,"span",3),e.qZA(),e.qZA(),e.YNc(8,at,107,161,"form",4),e.qZA(),e.YNc(9,lt,5,7,"div",5),e.qZA()),2&t&&(e.xp6(4),e.hij(" ",e.lcZ(5,5,n.isEdit?"editInvoice":"createInvoice")," "),e.xp6(2),e.Q6J("ngIf",n.preInvoice),e.xp6(1),e.Q6J("ngIf",n.advanceInvoice),e.xp6(1),e.Q6J("ngIf",n.formGroup),e.xp6(1),e.Q6J("ngIf",n.formGroup))},directives:[C.O5,c._Y,c.JL,c.sg,E.KE,E.hX,q.gD,c.JJ,c.u,C.sg,re.Nt,c.Fj,F.r,se.s,ce.gM,Je.ey,ae.nu,c.oH,w.oG,c.On,Le.U,c.CE,c.x0,J.ZL,J.XC],pipes:[A.X$,C.Ov],styles:[".wrapper[_ngcontent-%COMP%]{height:calc(100%)}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;height:calc(100% - 100px);overflow-y:auto}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;border-bottom:2px dotted var(--color-main-light)}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{flex-direction:column;margin-top:20px;display:flex;width:100%;color:var(--color-black)}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .create-buyer-button[_ngcontent-%COMP%]{margin:10px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .import-buttons[_ngcontent-%COMP%]{display:flex;margin:10px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .import-buttons[_ngcontent-%COMP%]   app-button[_ngcontent-%COMP%]{margin-right:20px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .bottom-padding[_ngcontent-%COMP%]{display:flex;align-items:center;padding-bottom:1.34375em;margin-left:20px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .invoice-items[_ngcontent-%COMP%]   .invoice-item[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .invoice-items[_ngcontent-%COMP%]   .invoice-item[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{flex-grow:1}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .invoice-items[_ngcontent-%COMP%]   .invoice-item[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .number-field[_ngcontent-%COMP%]{flex-shrink:1;max-width:100px}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.wrapper[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .big-button[_ngcontent-%COMP%]{margin-right:20px}.wrapper[_ngcontent-%COMP%]   .button-section[_ngcontent-%COMP%]{display:flex;width:100%;height:60px;flex-direction:row;align-items:center;justify-content:space-between}.additional-button[_ngcontent-%COMP%]{margin:10px 5px}"]}),i})(),canActivate:[me.Y],data:{permission:"INVOICE_CREATE"}}];let dt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[P.Bz.forChild(ut)],P.Bz]}),i})();var L=d(2024),mt=d(7707),pt=d(6688),j=d(7942),_t=d(5245),vt=d(7012),ue=d(6460),de=d(8287);let gt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[C.ez,j.p,w.p9,A.aw]]}),i})(),ht=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[C.ez,O.Is,L.h,A.aw,ue.n,E.lN,q.LD,de.n,gt,ne.Cq]]}),i})(),ft=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[C.ez,O.Is,L.h,A.aw,ue.n,E.lN,q.LD,de.n,j.p,w.p9,c.u5]]}),i})(),Ct=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[C.ez,dt,A.aw,L.h,mt.R,c.UX,re.c,E.lN,q.LD,pt.Hi,j.p,_t.Ps,ae.Co,ce.AV,se.I,vt.o,J.Bb,w.p9,ht,ft,c.u5]]}),i})()}}]);